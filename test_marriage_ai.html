<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合婚AI分析测试</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-info {
            background: #004455;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }
        .form-group {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #00d4ff;
        }
        select, input {
            width: 100%;
            padding: 8px;
            background: #333;
            border: 1px solid #555;
            color: #fff;
            border-radius: 4px;
        }
        .cyber-button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: #000;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
            position: relative;
            overflow: hidden;
        }
        .cyber-button:hover {
            background: linear-gradient(45deg, #00ffff, #00d4ff);
        }
        .cyber-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .result-panel {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #333;
        }
        .ai-analysis-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 12px;
            border: 1px solid #00d4ff;
        }
        .ai-description {
            color: #ccc;
            margin-bottom: 20px;
            font-style: italic;
        }
        .ai-marriage-processing {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        .processing-animation {
            margin-bottom: 15px;
        }
        .cyber-loader {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .ai-marriage-output {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00d4ff;
            margin: 20px 0;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .ai-error {
            background: #4a1a1a;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ff4444;
            text-align: center;
        }
        .error-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .error-message {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .error-suggestion {
            color: #ccc;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h1>🤖 合婚AI分析功能测试</h1>
            <p>测试新增的大模型合婚深度分析功能</p>
            <p><strong>测试步骤：</strong></p>
            <ol>
                <li>填写男女双方基本信息</li>
                <li>点击"开始合婚"生成基础分析</li>
                <li>在结果中点击"生成AI深度分析"</li>
                <li>查看AI分析结果和复制功能</li>
            </ol>
            <p><strong>注意：</strong>需要配置有效的AI API密钥才能使用AI分析功能</p>
            <button class="cyber-button" onclick="showAIConfig()">配置AI设置</button>
            <button class="cyber-button" onclick="testAIConnection()">测试AI连接</button>
        </div>

        <form id="hehun-form" class="cyber-form">
            <div class="test-section">
                <h3>男方信息</h3>
                <div class="form-group">
                    <label>姓名</label>
                    <input type="text" name="maleName" value="张三" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>出生年份</label>
                        <select name="maleBirthYear" required>
                            <option value="">选择年份</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生月份</label>
                        <select name="maleBirthMonth" required>
                            <option value="">选择月份</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生日期</label>
                        <select name="maleBirthDay" required>
                            <option value="">选择日期</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>出生时间</label>
                        <select name="maleBirthHour" required>
                            <option value="">时</option>
                            <option value="8" selected>08时</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生分钟</label>
                        <select name="maleBirthMinute" required>
                            <option value="0" selected>00分</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>出生省份</label>
                        <select name="maleBirthProvince" required>
                            <option value="">选择省份</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生城市</label>
                        <select name="maleBirthCity" required>
                            <option value="">选择城市</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h3>女方信息</h3>
                <div class="form-group">
                    <label>姓名</label>
                    <input type="text" name="femaleName" value="李四" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>出生年份</label>
                        <select name="femaleBirthYear" required>
                            <option value="">选择年份</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生月份</label>
                        <select name="femaleBirthMonth" required>
                            <option value="">选择月份</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生日期</label>
                        <select name="femaleBirthDay" required>
                            <option value="">选择日期</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>出生时间</label>
                        <select name="femaleBirthHour" required>
                            <option value="">时</option>
                            <option value="14" selected>14时</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生分钟</label>
                        <select name="femaleBirthMinute" required>
                            <option value="30" selected>30分</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>出生省份</label>
                        <select name="femaleBirthProvince" required>
                            <option value="">选择省份</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出生城市</label>
                        <select name="femaleBirthCity" required>
                            <option value="">选择城市</option>
                        </select>
                    </div>
                </div>
            </div>

            <button type="submit" class="cyber-button">
                <span>开始合婚</span>
            </button>
        </form>

        <div class="result-panel" id="hehun-result" style="display: none;">
            <div class="result-content">
                <!-- 合婚结果将在这里显示 -->
            </div>
        </div>
    </div>

    <script src="js/bazi-calculator.js"></script>
    <script src="js/ziwei-calculator.js"></script>
    <script src="js/name-calculator.js"></script>
    <script src="js/marriage-calculator.js"></script>
    <script src="js/main.js"></script>
    <script>
        // 初始化应用
        const app = new CyberFortune();

        // 设置测试用的AI配置
        function setupTestAIConfig() {
            const testConfig = {
                apiUrl: 'https://api.openai.com/v1/chat/completions',
                apiKey: 'your-api-key-here',
                model: 'gpt-3.5-turbo'
            };
            localStorage.setItem('cyberFortune_globalConfig', JSON.stringify(testConfig));
            console.log('测试AI配置已设置:', testConfig);
        }

        // 页面加载时设置测试配置
        setupTestAIConfig();
        
        // 设置默认值
        document.addEventListener('DOMContentLoaded', function() {
            // 设置默认年份
            const maleYear = document.querySelector('select[name="maleBirthYear"]');
            const femaleYear = document.querySelector('select[name="femaleBirthYear"]');
            if (maleYear && femaleYear) {
                setTimeout(() => {
                    maleYear.value = '1990';
                    femaleYear.value = '1992';
                    
                    // 设置默认月份
                    const maleMonth = document.querySelector('select[name="maleBirthMonth"]');
                    const femaleMonth = document.querySelector('select[name="femaleBirthMonth"]');
                    if (maleMonth && femaleMonth) {
                        maleMonth.value = '5';
                        femaleMonth.value = '8';
                        
                        // 触发月份变化事件来更新日期
                        maleMonth.dispatchEvent(new Event('change'));
                        femaleMonth.dispatchEvent(new Event('change'));
                        
                        // 设置默认日期
                        setTimeout(() => {
                            const maleDay = document.querySelector('select[name="maleBirthDay"]');
                            const femaleDay = document.querySelector('select[name="femaleBirthDay"]');
                            if (maleDay && femaleDay) {
                                maleDay.value = '15';
                                femaleDay.value = '20';
                            }
                        }, 100);
                    }
                    
                    // 设置默认省份
                    const maleProv = document.querySelector('select[name="maleBirthProvince"]');
                    const femaleProv = document.querySelector('select[name="femaleBirthProvince"]');
                    if (maleProv && femaleProv) {
                        maleProv.value = '北京市';
                        femaleProv.value = '上海市';
                        
                        // 触发省份变化事件来更新城市
                        maleProv.dispatchEvent(new Event('change'));
                        femaleProv.dispatchEvent(new Event('change'));
                    }
                }, 500);
            }
        });

        // 显示AI配置对话框
        function showAIConfig() {
            const config = JSON.parse(localStorage.getItem('cyberFortune_globalConfig') || '{}');
            const apiUrl = prompt('请输入API地址:', config.apiUrl || 'https://api.openai.com/v1/chat/completions');
            const apiKey = prompt('请输入API密钥:', config.apiKey || '');
            const model = prompt('请输入模型名称:', config.model || 'gpt-3.5-turbo');

            if (apiUrl && apiKey && model) {
                const newConfig = { apiUrl, apiKey, model };
                localStorage.setItem('cyberFortune_globalConfig', JSON.stringify(newConfig));
                alert('AI配置已保存');
                console.log('AI配置已更新:', newConfig);
            }
        }

        // 测试AI连接
        function testAIConnection() {
            const config = JSON.parse(localStorage.getItem('cyberFortune_globalConfig') || '{}');
            if (!config.apiKey) {
                alert('请先配置AI设置');
                return;
            }

            console.log('当前AI配置:', config);
            alert('AI配置检查完成，请查看控制台输出');
        }
    </script>
</body>
</html>
