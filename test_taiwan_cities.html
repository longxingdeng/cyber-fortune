<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台湾城市数据测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .test-section {
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .city-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .city-card {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .city-name {
            font-size: 18px;
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 10px;
        }
        .city-longitude {
            font-size: 14px;
            color: #ffffff;
            font-family: 'Courier New', monospace;
        }
        .correction-info {
            font-size: 12px;
            color: #ffc107;
            margin-top: 5px;
        }
        button {
            background: #00ffff;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #00cccc;
        }
        .stats {
            background: rgba(0, 255, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid rgba(0, 255, 255, 0.3);
            padding: 10px;
            text-align: center;
        }
        .comparison-table th {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
        }
    </style>
</head>
<body>
    <h1>台湾省城市数据测试</h1>
    
    <div class="test-section">
        <h2>测试控制</h2>
        <button onclick="showTaiwanCities()">显示台湾城市</button>
        <button onclick="testTrueSolarTime()">测试真太阳时修正</button>
        <button onclick="compareWithMainland()">与大陆城市对比</button>
    </div>

    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/lunisolar@2.5.1/dist/lunisolar.min.js"></script>
    <script src="js/bazi-calculator.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');
        let calculator;

        function addResult(title, content) {
            const div = document.createElement('div');
            div.className = 'test-section';
            div.innerHTML = `
                <h3>${title}</h3>
                <div>${content}</div>
            `;
            resultsDiv.appendChild(div);
        }

        function showTaiwanCities() {
            resultsDiv.innerHTML = '';
            
            if (!calculator) {
                calculator = new BaziCalculator();
            }

            const taiwanData = calculator.locationData["台湾省"];
            if (!taiwanData) {
                addResult('错误', '未找到台湾省数据');
                return;
            }

            const cities = Object.keys(taiwanData);
            let content = `
                <div class="stats">
                    <h4>台湾省概览</h4>
                    <p>城市数量：${cities.length}个</p>
                    <p>经度范围：${Math.min(...cities.map(city => taiwanData[city].longitude)).toFixed(1)}°E - ${Math.max(...cities.map(city => taiwanData[city].longitude)).toFixed(1)}°E</p>
                </div>
                <div class="city-grid">
            `;

            cities.forEach(city => {
                const longitude = taiwanData[city].longitude;
                const correction = (longitude - 120.0) * 4; // 经度修正（分钟）
                
                content += `
                    <div class="city-card">
                        <div class="city-name">${city}</div>
                        <div class="city-longitude">${longitude}°E</div>
                        <div class="correction-info">
                            修正: ${correction >= 0 ? '+' : ''}${correction.toFixed(1)}分钟
                        </div>
                    </div>
                `;
            });

            content += '</div>';
            addResult('台湾省城市数据', content);
        }

        function testTrueSolarTime() {
            if (!calculator) {
                calculator = new BaziCalculator();
            }

            const taiwanData = calculator.locationData["台湾省"];
            const testTime = { year: 2024, month: 1, day: 15, hour: 12, minute: 0 };
            
            let content = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>城市</th>
                            <th>经度</th>
                            <th>原始时间</th>
                            <th>修正时间</th>
                            <th>修正值</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            Object.keys(taiwanData).forEach(city => {
                const longitude = taiwanData[city].longitude;
                const trueSolarTime = calculator.calculateTrueSolarTime(
                    testTime.year, testTime.month, testTime.day, 
                    testTime.hour, testTime.minute, longitude
                );
                
                content += `
                    <tr>
                        <td>${city}</td>
                        <td>${longitude}°E</td>
                        <td>${trueSolarTime.originalTime}</td>
                        <td>${trueSolarTime.correctedTime}</td>
                        <td>${trueSolarTime.correction >= 0 ? '+' : ''}${trueSolarTime.correction.toFixed(1)}分钟</td>
                    </tr>
                `;
            });

            content += '</tbody></table>';
            addResult('台湾真太阳时修正测试', content);
        }

        function compareWithMainland() {
            if (!calculator) {
                calculator = new BaziCalculator();
            }

            const taiwanData = calculator.locationData["台湾省"];
            const mainlandCities = {
                "北京市": calculator.locationData["北京市"]["北京市"],
                "上海市": calculator.locationData["上海市"]["上海市"],
                "广州市": calculator.locationData["广东省"]["广州市"],
                "深圳市": calculator.locationData["广东省"]["深圳市"],
                "乌鲁木齐市": calculator.locationData["新疆维吾尔自治区"]["乌鲁木齐市"]
            };

            let content = `
                <h4>台湾与大陆主要城市经度对比</h4>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>地区</th>
                            <th>城市</th>
                            <th>经度</th>
                            <th>与北京时差</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // 台湾城市
            Object.keys(taiwanData).forEach(city => {
                const longitude = taiwanData[city].longitude;
                const timeDiff = (longitude - 116.4) * 4; // 与北京的时差
                
                content += `
                    <tr>
                        <td>台湾省</td>
                        <td>${city}</td>
                        <td>${longitude}°E</td>
                        <td>${timeDiff >= 0 ? '+' : ''}${timeDiff.toFixed(1)}分钟</td>
                    </tr>
                `;
            });

            // 大陆城市
            Object.keys(mainlandCities).forEach(city => {
                const longitude = mainlandCities[city].longitude;
                const timeDiff = (longitude - 116.4) * 4; // 与北京的时差
                
                content += `
                    <tr>
                        <td>大陆</td>
                        <td>${city}</td>
                        <td>${longitude}°E</td>
                        <td>${timeDiff >= 0 ? '+' : ''}${timeDiff.toFixed(1)}分钟</td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            // 添加统计信息
            const taiwanLongitudes = Object.values(taiwanData).map(city => city.longitude);
            const taiwanAvg = taiwanLongitudes.reduce((a, b) => a + b, 0) / taiwanLongitudes.length;
            
            content += `
                <div class="stats">
                    <h4>统计对比</h4>
                    <p>台湾平均经度：${taiwanAvg.toFixed(1)}°E</p>
                    <p>台湾经度范围：${Math.min(...taiwanLongitudes).toFixed(1)}°E - ${Math.max(...taiwanLongitudes).toFixed(1)}°E</p>
                    <p>与标准时间差异：${((taiwanAvg - 120.0) * 4).toFixed(1)}分钟</p>
                </div>
            `;

            addResult('台湾与大陆城市对比', content);
        }

        // 页面加载时初始化
        window.onload = function() {
            calculator = new BaziCalculator();
            addResult('系统初始化', '台湾城市数据测试页面已加载，可以开始测试');
            showTaiwanCities();
        };
    </script>
</body>
</html>
