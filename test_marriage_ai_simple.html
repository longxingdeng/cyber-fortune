<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆå©šAIåˆ†æç®€å•æµ‹è¯•</title>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #00d4ff;
            color: #000;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
        }
        button:hover {
            background: #00ffff;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .result {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #00d4ff;
        }
        .error {
            background: #4a1a1a;
            border-left-color: #ff4444;
        }
        .processing {
            text-align: center;
            padding: 20px;
        }
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* åˆå©šAIåˆ†ææ ·å¼ */
        .ai-marriage-output {
            background: linear-gradient(135deg, rgba(255, 0, 128, 0.05), rgba(0, 212, 255, 0.05));
            border: 1px solid rgba(255, 0, 128, 0.2);
            border-radius: 8px;
            padding: 1.5rem;
            color: #fff;
            line-height: 1.6;
            white-space: pre-wrap;
            font-size: 0.95rem;
        }

        .ai-marriage-output h1,
        .ai-marriage-output h2,
        .ai-marriage-output h3,
        .ai-marriage-output h4 {
            color: #00d4ff;
            margin: 1rem 0 0.6rem 0;
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }

        .ai-marriage-output h1 {
            font-size: 1.6rem;
            border-bottom: 2px solid #00d4ff;
            padding-bottom: 0.5rem;
            text-align: center;
            margin: 0 0 1rem 0;
        }

        .ai-marriage-output h2 {
            font-size: 1.4rem;
            border-left: 4px solid #00ff88;
            padding-left: 1rem;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 4px;
            margin: 1.2rem 0 0.8rem 0;
        }

        .ai-marriage-output h3 {
            font-size: 1.2rem;
            color: #00ff88;
            margin: 0.8rem 0 0.5rem 0;
        }

        .ai-marriage-output h4 {
            font-size: 1.1rem;
            color: #ff0080;
            margin: 0.6rem 0 0.4rem 0;
        }

        .ai-marriage-output strong {
            color: #00ff88;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 136, 0.3);
        }

        .ai-marriage-output em {
            color: #ff0080;
            font-style: italic;
            text-shadow: 0 0 5px rgba(255, 0, 128, 0.3);
        }

        .ai-marriage-output .highlight {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.2), transparent);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            border-left: 2px solid #00ff88;
            font-weight: bold;
            color: #00ff88;
        }

        .ai-marriage-output .suggestion-box {
            background: rgba(255, 0, 128, 0.1);
            border: 1px solid rgba(255, 0, 128, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin: 0.6rem 0;
        }

        .ai-marriage-output .warning-box {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 6px;
            padding: 0.6rem;
            margin: 0.5rem 0;
            color: #ffa500;
            border-left: 4px solid #ffa500;
        }

        .ai-marriage-output .success-box {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 6px;
            padding: 0.6rem;
            margin: 0.5rem 0;
            color: #00ff88;
            border-left: 4px solid #00ff88;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h1>ğŸ¤– åˆå©šAIåˆ†æç®€å•æµ‹è¯•</h1>
        <p>è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„æµ‹è¯•é¡µé¢ï¼Œç”¨äºéªŒè¯åˆå©šAIåˆ†æåŠŸèƒ½</p>
        
        <h3>æ­¥éª¤1: é…ç½®AIè®¾ç½®</h3>
        <button onclick="configureAI()">é…ç½®AIè®¾ç½®</button>
        <button onclick="checkConfig()">æ£€æŸ¥å½“å‰é…ç½®</button>
        
        <h3>æ­¥éª¤2: æµ‹è¯•AIåˆ†æ</h3>
        <button onclick="testMarriageAI()" id="testBtn">æµ‹è¯•åˆå©šAIåˆ†æ</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>

    <div id="results"></div>

    <script>
        // é…ç½®AIè®¾ç½®
        function configureAI() {
            const apiUrl = prompt('è¯·è¾“å…¥APIåœ°å€:', 'https://api.openai.com/v1/chat/completions');
            const apiKey = prompt('è¯·è¾“å…¥APIå¯†é’¥:', '');
            const model = prompt('è¯·è¾“å…¥æ¨¡å‹åç§°:', 'gpt-3.5-turbo');
            
            if (apiUrl && apiKey && model) {
                const config = { apiUrl, apiKey, model };
                localStorage.setItem('cyberFortune_globalConfig', JSON.stringify(config));
                showResult('AIé…ç½®å·²ä¿å­˜: ' + JSON.stringify(config, null, 2), 'success');
            }
        }

        // æ£€æŸ¥å½“å‰é…ç½®
        function checkConfig() {
            const config = localStorage.getItem('cyberFortune_globalConfig');
            if (config) {
                const parsed = JSON.parse(config);
                // éšè—APIå¯†é’¥çš„éƒ¨åˆ†å­—ç¬¦
                const safeConfig = {
                    ...parsed,
                    apiKey: parsed.apiKey ? parsed.apiKey.substring(0, 10) + '...' : ''
                };
                showResult('å½“å‰AIé…ç½®: ' + JSON.stringify(safeConfig, null, 2), 'success');
            } else {
                showResult('æœªæ‰¾åˆ°AIé…ç½®', 'error');
            }
        }

        // æµ‹è¯•åˆå©šAIåˆ†æ
        async function testMarriageAI() {
            const config = localStorage.getItem('cyberFortune_globalConfig');
            if (!config) {
                showResult('è¯·å…ˆé…ç½®AIè®¾ç½®', 'error');
                return;
            }

            const { apiUrl, apiKey, model } = JSON.parse(config);
            
            // æ¨¡æ‹Ÿåˆå©šæ•°æ®
            const testPrompt = `ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­å›½ä¼ ç»Ÿåˆå©šç†è®ºçš„ä¸“å®¶ã€‚è¯·åˆ†æä»¥ä¸‹åˆå©šä¿¡æ¯ï¼š

ã€ç”·æ–¹ä¿¡æ¯ã€‘
å§“åï¼šå¼ ä¸‰
å‡ºç”Ÿæ—¶é—´ï¼š1990å¹´5æœˆ15æ—¥ 08:00
ç”Ÿè‚–ï¼šé©¬

ã€å¥³æ–¹ä¿¡æ¯ã€‘
å§“åï¼šæå››
å‡ºç”Ÿæ—¶é—´ï¼š1992å¹´8æœˆ20æ—¥ 14:30
ç”Ÿè‚–ï¼šçŒ´

ã€åŸºç¡€åˆå©šåˆ†æç»“æœã€‘
ç»¼åˆåŒ¹é…åº¦ï¼š75åˆ† (æ¯”è¾ƒåŒ¹é…)
ç”Ÿè‚–é…å¯¹ï¼š70åˆ†
äº”è¡Œé…å¯¹ï¼š80åˆ†

è¯·æä¾›è¯¦ç»†çš„åˆå©šåˆ†æå»ºè®®ã€‚`;

            showProcessing();
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            {
                                role: "system",
                                content: "ä½ æ˜¯ç²¾é€šä¸­å›½ä¼ ç»Ÿåˆå©šç†è®ºçš„ä¸“å®¶ã€‚"
                            },
                            {
                                role: "user",
                                content: testPrompt
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`APIé”™è¯¯ (${response.status}): ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
                }

                const data = await response.json();
                const result = data.choices?.[0]?.message?.content || 'æœªè·å–åˆ°åˆ†æç»“æœ';
                
                showResult('AIåˆ†æç»“æœ:\n\n' + result, 'success');
                
            } catch (error) {
                console.error('AIåˆ†æå¤±è´¥:', error);
                showResult('AIåˆ†æå¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
        function showProcessing() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="result processing">
                    <div class="loader"></div>
                    <p>æ­£åœ¨è¿›è¡ŒAIåˆ†æï¼Œè¯·ç¨å€™...</p>
                </div>
            `;
            
            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = true;
            testBtn.textContent = 'åˆ†æä¸­...';
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(message, type) {
            const resultsDiv = document.getElementById('results');

            if (type === 'error') {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <pre>${message}</pre>
                    </div>
                `;
            } else {
                // ä½¿ç”¨åˆå©šAIçš„æ ¼å¼åŒ–å‡½æ•°
                const formatted = formatMarriageAIResponse(message);
                resultsDiv.innerHTML = `
                    <div class="result">
                        <div class="ai-marriage-output">
                            ${formatted}
                        </div>
                    </div>
                `;
            }

            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = false;
            testBtn.textContent = 'æµ‹è¯•åˆå©šAIåˆ†æ';
        }

        // ç®€åŒ–ç‰ˆçš„æ ¼å¼åŒ–å‡½æ•°
        function formatMarriageAIResponse(text) {
            if (!text) return '<div class="ai-response-streaming">æ­£åœ¨ç”Ÿæˆåˆ†æ...</div>';

            let formatted = text;

            // å¤„ç†æ ‡é¢˜å±‚çº§
            formatted = formatted
                .replace(/^# (.*?)$/gm, '<h1>$1</h1>')
                .replace(/^## (.*?)$/gm, '<h2>$1</h2>')
                .replace(/^### (.*?)$/gm, '<h3>$1</h3>')
                .replace(/^#### (.*?)$/gm, '<h4>$1</h4>');

            // å¤„ç†ç²—ä½“å’Œæ–œä½“
            formatted = formatted
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');

            // å¤„ç†ç‰¹æ®Šæ ‡è®°
            formatted = formatted
                .replace(/ã€(.*?)ã€‘/g, '<span class="highlight">ã€$1ã€‘</span>')
                .replace(/ğŸ’¡\s*(.*?)$/gm, '<div class="suggestion-box">ğŸ’¡ $1</div>')
                .replace(/âš ï¸\s*(.*?)$/gm, '<div class="warning-box">âš ï¸ $1</div>')
                .replace(/âœ…\s*(.*?)$/gm, '<div class="success-box">âœ… $1</div>');

            // å¤„ç†æ®µè½
            formatted = formatted.replace(/\n\n/g, '</p><p>');
            if (!formatted.includes('<p>')) {
                formatted = '<p>' + formatted + '</p>';
            }

            return formatted;
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
