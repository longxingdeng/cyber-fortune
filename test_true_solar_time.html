<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>真太阳时修正测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .test-section {
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-result {
            background: rgba(0, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        button {
            background: #00ffff;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #00cccc;
        }
        .error {
            color: #ff6b6b;
        }
        .success {
            color: #00ff88;
        }
    </style>
</head>
<body>
    <h1>真太阳时修正功能测试</h1>
    
    <div class="test-section">
        <h2>测试用例</h2>
        <button onclick="testBeijing()">测试北京时间</button>
        <button onclick="testShanghai()">测试上海时间</button>
        <button onclick="testUrumqi()">测试乌鲁木齐时间</button>
        <button onclick="testLhasa()">测试拉萨时间</button>
        <button onclick="testAllCities()">测试所有城市</button>
    </div>

    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/lunisolar@2.5.1/dist/lunisolar.min.js"></script>
    <script src="js/bazi-calculator.js"></script>
    <script>
        const calculator = new BaziCalculator();
        const resultsDiv = document.getElementById('results');

        function addResult(title, content, isError = false) {
            const div = document.createElement('div');
            div.className = 'test-result';
            div.innerHTML = `
                <h3 class="${isError ? 'error' : 'success'}">${title}</h3>
                <pre>${content}</pre>
            `;
            resultsDiv.appendChild(div);
        }

        function testCity(cityName, province, city, testTime) {
            try {
                const birthData = {
                    year: 1990,
                    month: 6,
                    day: 15,
                    hour: testTime.hour,
                    minute: testTime.minute,
                    gender: '男',
                    birthProvince: province,
                    birthCity: city
                };

                const result = calculator.calculate(birthData);
                const info = result.trueSolarTimeInfo;
                
                const content = `
出生地点: ${info.location}
经度: ${info.longitude}°E
原始时间: ${info.originalTime}
修正时间: ${info.correctedTime}
总修正: ${info.correction.toFixed(2)}分钟
经度修正: ${info.longitudeCorrection.toFixed(2)}分钟
时间方程: ${info.timeEquation.toFixed(2)}分钟
八字: ${result.fullBazi}
                `;
                
                addResult(`${cityName} 测试成功`, content);
            } catch (error) {
                addResult(`${cityName} 测试失败`, error.message, true);
            }
        }

        function testBeijing() {
            testCity('北京', '北京市', '北京市', {hour: 12, minute: 0});
        }

        function testShanghai() {
            testCity('上海', '上海市', '上海市', {hour: 12, minute: 0});
        }

        function testUrumqi() {
            testCity('乌鲁木齐', '新疆维吾尔自治区', '乌鲁木齐市', {hour: 12, minute: 0});
        }

        function testLhasa() {
            testCity('拉萨', '西藏自治区', '拉萨市', {hour: 12, minute: 0});
        }

        function testAllCities() {
            resultsDiv.innerHTML = '';
            
            const testCases = [
                ['北京', '北京市', '北京市'],
                ['上海', '上海市', '上海市'],
                ['广州', '广东省', '广州市'],
                ['深圳', '广东省', '深圳市'],
                ['台北', '台湾省', '台北市'],
                ['高雄', '台湾省', '高雄市'],
                ['成都', '四川省', '成都市'],
                ['西安', '陕西省', '西安市'],
                ['乌鲁木齐', '新疆维吾尔自治区', '乌鲁木齐市'],
                ['拉萨', '西藏自治区', '拉萨市'],
                ['哈尔滨', '黑龙江省', '哈尔滨市'],
                ['昆明', '云南省', '昆明市']
            ];

            testCases.forEach(([name, province, city]) => {
                testCity(name, province, city, {hour: 12, minute: 0});
            });
        }

        // 页面加载时运行一个简单测试
        window.onload = function() {
            addResult('系统初始化', '真太阳时修正功能已加载，可以开始测试');
        };
    </script>
</body>
</html>
