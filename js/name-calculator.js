// èµ›åšè®ºå‘½ - èµ·åè®¡ç®—æ¨¡å—

class NameCalculator {
    // äº”è¡Œå±æ€§å­—å…¸ï¼ˆå®Œæ•´ç‰ˆï¼‰
    constructor() {
        this.wuXingDict = {
            'æœ¨': ['ç”²','ä¹™','å¯…','å¯','ä¸œ','é’','æ˜¥','ç”Ÿ','é•¿','ä»','æŸ”','æ›²','ç›´','é…¸','è‚','è§’','é£','éº¦','æ','é¸¡'],
            'ç«': ['ä¸™','ä¸','å·³','åˆ','å—','çº¢','å¤','çƒ­','æ˜','ç¤¼','æ€¥','ä¸Š','ç‚','è‹¦','å¿ƒ','å¾µ','æš‘','é»','æ','ç¾Š'],
            'åœŸ': ['æˆŠ','å·±','è¾°','æˆŒ','ä¸‘','æœª','ä¸­','é»„','å­£å¤','åš','ä¿¡','é‡','è½½','åŒ–','ç”˜','è„¾','å®«','æ¹¿','ç¨·','æ£','ç‰›'],
            'é‡‘': ['åºš','è¾›','ç”³','é…‰','è¥¿','ç™½','ç§‹','å‡‰','æ”¶','ä¹‰','åˆš','é”','åˆ©','è¾›','è‚º','å•†','ç‡¥','ç¨»','æ¡ƒ','é©¬'],
            'æ°´': ['å£¬','ç™¸','äº¥','å­','åŒ—','é»‘','å†¬','å¯’','è—','æ™º','æŸ”','ä¸‹','æ¶¦','å’¸','è‚¾','ç¾½','å¯’','è±†','æ —','çŒª']
        };

        // å¸¸ç”¨èµ·åç”¨å­—äº”è¡Œå±æ€§
        this.charWuXing = {
            // æœ¨å±æ€§å­— (32å­—)
            'æœ¨': ['æ—','æ£®','æ ‘','æ','å¶','èŠ±','è‰','ç«¹','æ¾','æŸ','æ¢…','å…°','èŠ','è²','è·','èŠ³','èŠ¬','èŠ¸','è‹—','èŒ‚','è‹±','å','è“','ç»¿','é’','è“‰','èŠŠ','èŒ‰','è‘µ','æ«','æ¥ ','æ¡¦'],

            // ç«å±æ€§å­— (31å­—)
            'ç«': ['ç«','ç‚','ç„°','çƒˆ','çƒ­','æš–','é˜³','å…‰','æ˜','äº®','è¾‰','ç¿','çƒ‚','çº¢','æœ±','ä¸¹','å½¤','èµ¤','æ™¨','æ˜Š','æ˜•','æ™“','æ™–','ç…Œ','ç…œ','ç…Š','ç‚œ','ç‚«','ç†™','çƒ¨','ç„•'],

            // åœŸå±æ€§å­— (33å­—)
            'åœŸ': ['åœŸ','åœ°','å±±','å²©','çŸ³','å²—','å³°','å²­','å¤','åŸ¹','åŸ','å ¡','å¢¨','é»„','æ£•','è¤','åš','é‡','ç¨³','å®‰','å®','é™','å’Œ','å¹³','å ‚','åŸº','åœ£','åŸŸ','å¢','å¦','ç¡•','ç£Š','å£'],

            // é‡‘å±æ€§å­— (32å­—)
            'é‡‘': ['é‡‘','é“¶','é“œ','é“','é’¢','é”‹','åˆ©','åˆ€','å‰‘','é’Ÿ','é“ƒ','é”¦','é’°','é‘«','ç™½','ç´ ','æ´','å‡€','æ¸…','çˆ½','åˆš','å¼º','åš','ç¡¬','é”','é“®','é“­','é“ ','é’§','é“„','é•‡','é”´'],

            // æ°´å±æ€§å­— (33å­—)
            'æ°´': ['æ°´','æ±Ÿ','æ²³','æ¹–','æµ·','æ³¢','æµª','æµ','æºª','æ³‰','é›¨','é›ª','å†°','éœœ','éœ²','äº‘','é›¾','é»‘','è“','æ·±','æ¶¦','æ¹¿','æŸ”','è½¯','æ²›','æ¶µ','æ¶›','æµ©','æ³½','æ¸Š','æ½‡','æ¾œ','æ±']
        };

        // å®Œæ•´ä¸‰æ‰é…ç½®å‰å‡¶è¡¨ï¼ˆå¤©æ ¼-äººæ ¼-åœ°æ ¼ï¼‰
        this.sanCaiTable = {
            /* æœ¨ç³»ä¸‰æ‰ï¼ˆå¤©æ ¼1ï¼‰ */
            '111': 'å¤§å‰', '112': 'å¤§å‰', '113': 'å¤§å‰', '114': 'å‡¶', '115': 'åŠå‰',
            '121': 'å¤§å‰', '122': 'ä¸­å‰', '123': 'å¤§å‰', '124': 'å‡¶', '125': 'å¤§å‡¶',
            '131': 'å‡¶', '132': 'ä¸­å‰', '133': 'ä¸­å‰', '134': 'å‡¶', '135': 'å‡¶',
            '141': 'å¤§å‡¶', '142': 'å¤§å‡¶', '143': 'å‡¶', '144': 'å¤§å‡¶', '145': 'å¤§å‡¶',
            '151': 'å‡¶', '152': 'å‡¶', '153': 'å‡¶', '154': 'å¤§å‡¶', '155': 'å‡¶',
            
            /* ç«ç³»ä¸‰æ‰ï¼ˆå¤©æ ¼2ï¼‰ */
            '211': 'å¤§å‰', '212': 'å¤§å‰', '213': 'å¤§å‰', '214': 'å‡¶', '215': 'å‡¶',
            '221': 'å¤§å‰', '222': 'ä¸­å‰', '223': 'å¤§å‰', '224': 'å‡¶', '225': 'å¤§å‡¶',
            '231': 'ä¸­å‰', '232': 'å¤§å‰', '233': 'å¤§å‰', '234': 'å¤§å‰', '235': 'ä¸­å‰',
            '241': 'å‡¶', '242': 'å‡¶', '243': 'å‡¶', '244': 'å‡¶', '245': 'å¤§å‡¶',
            '251': 'å‡¶', '252': 'å¤§å‡¶', '253': 'å‡¶', '254': 'å‡¶', '255': 'å‡¶',
            
            /* åœŸç³»ä¸‰æ‰ï¼ˆå¤©æ ¼3ï¼‰ */
            '311': 'å‡¶', '312': 'ä¸­å‰', '313': 'å‡¶', '314': 'å‡¶', '315': 'å‡¶',
            '321': 'å¤§å‰', '322': 'å¤§å‰', '323': 'å¤§å‰', '324': 'ä¸­å‰', '325': 'å‡¶',
            '331': 'å‡¶', '332': 'å¤§å‰', '333': 'å¤§å‰', '334': 'å¤§å‰', '335': 'å‡¶',
            '341': 'å‡¶', '342': 'å‡¶', '343': 'å¤§å‰', '344': 'å¤§å‰', '345': 'å¤§å‰',
            '351': 'å‡¶', '352': 'å‡¶', '353': 'å‡¶', '354': 'ä¸­å‰', '355': 'å‡¶',
            
            /* é‡‘ç³»ä¸‰æ‰ï¼ˆå¤©æ ¼4ï¼‰ */
            '411': 'å‡¶', '412': 'å‡¶', '413': 'å‡¶', '414': 'å¤§å‡¶', '415': 'å‡¶',
            '421': 'å‡¶', '422': 'å‡¶', '423': 'ä¸­å‰', '424': 'å‡¶', '425': 'å¤§å‡¶',
            '431': 'å‡¶', '432': 'ä¸­å‰', '433': 'ä¸­å‰', '434': 'å¤§å‰', '435': 'ä¸­å‰',
            '441': 'å‡¶', '442': 'å‡¶', '443': 'å¤§å‰', '444': 'ä¸­å¹³', '445': 'ä¸­å‰',
            '451': 'ä¸­å‰', '452': 'å‡¶', '453': 'ä¸­å‰', '454': 'ä¸­å‰', '455': 'å¤§å‰',
            
            /* æ°´ç³»ä¸‰æ‰ï¼ˆå¤©æ ¼5ï¼‰ */
            '511': 'ä¸­å‰', '512': 'ä¸­å‰', '513': 'ä¸­å‰', '514': 'å‡¶', '515': 'å¤§å‰',
            '521': 'å¤§å‡¶', '522': 'å¤§å‡¶', '523': 'å‡¶', '524': 'å‡¶', '525': 'å¤§å‡¶',
            '531': 'å‡¶', '532': 'ä¸­å‰', '533': 'ä¸­å‰', '534': 'ä¸­å‰', '535': 'å‡¶',
            '541': 'å‡¶', '542': 'å‡¶', '543': 'ä¸­å‰', '544': 'ä¸­å‰', '545': 'å¤§å‰',
            '551': 'å¤§å‰', '552': 'å‡¶', '553': 'å‡¶', '554': 'å¤§å‰', '555': 'ä¸­å¹³'
        };

        // å¢å¼ºç‰ˆå¸¸ç”¨å¥½å­—æ¨èï¼ˆæ¯ä¸ªå±æ€§20å­—ï¼‰
        this.goodChars = {
            'ç”·': {
                'æœ¨': ['æ—','æ£®','æ°','æ¥ ','æ¾','æŸ','æ¢“','æ¡','æ ‹','å½¬','æ¥·','æ«','æ¦•','æ¥š','æŸ¯','è£','æ¡“','æƒ','æ£®','æ ‹','æ¢','æ¨','æŸ³','æ¡‚','æ¡¦','æ¢§','æ£ ','æ££','æ£®','æ£‹'],
                'ç«': ['ç‚','ç„±','ç…œ','çƒ¨','è¾‰','æ™–','æ˜','æ˜Š','æ™¨','æ—­','ç‚œ','ç‚«','ç†™','ç…Š','ç¿','ç‚…','çƒ½','ç† ','æ™Ÿ','æ›œ','ç…¦','èµ«','é˜³','æœ—','æ›œ','æ˜­','æ˜±','ç‚¯','ç¼','ç„•'],
                'åœŸ': ['å¤','åŸ¹','åŸ','å¢¨','è½©','å®‡','å®‰','å®','ç¨³','åš','åŸº','åœ£','å ‚','åš','ç£Š','ç¡•','å¢','å¦','åš','åœ­','å£','å³¥','åµ˜','å²—','å´‡','å³»','å³°','å²±','å²©','å³¥'],
                'é‡‘': ['é‘«','é”‹','é’¢','é“­','é”','é’°','åˆš','å¼º','åš','æ¯…','é“®','é“„','é“ ','é’§','é”¦','é”','é”´','é•‡','é••','é“','é’Š','é’º','é”Ÿ','é•','é“®','é“‰','é”','é“–','é“ ','é“§'],
                'æ°´': ['æ±Ÿ','æ²³','æµ·','æ³¢','æ¶›','æ¶¦','æ³½','æ´‹','æµ©','æ¸Š','æ²›','æ¶µ','ç€š','ç','æ½‡','æ¾œ','æ³“','æµš','æ·³','æ¾ˆ','æ¹›','æ¾','æ·¼','æºª','æ½®','æ²','æ³·','æ·','æ·®','æºŸ']
            },
            'å¥³': {
                'æœ¨': ['æ—','æ¢…','å…°','èŠ','è²','è·','èŠ³','èŠ¬','èŠ¸','è•¾','è“‰','èŠŠ','èŒ‰','è‘µ','è–‡','èŒœ','è•Š','è±','èŠ™','è‹“','èŠ·','èŒµ','è”“','è','è•¾','è”','æª¬','æª¬','æ¨±','æ‰','æ¡'],
                'ç«': ['æ™¨','æ˜•','æ™“','æ™–','ä¸¹','å½¤','çº¢','æœ±','ç¿','çƒ‚','æ™´','æ™¶','çµ','æš–','æ™—','æ—»','æ˜­','æ™—','ç„“','ç† ','ç…Š','ç…–','çƒ¨','ç…','ç…£','ç†³','ç…œ','ç„“','ç…£','ç„«'],
                'åœŸ': ['å®‰','å®','é™','å’Œ','å¹³','é›…','ç´ ','çº¯','çœŸ','ç¾','å©‰','å¨´','å¨…','æ€¡','åœ†','å®¹','å®›','å²š','å²«','å²‘','åŸ¹','åŸ¼','å ‡','å­','åš','å ƒ','å¢','å¢€','å¢¨','åœ­'],
                'é‡‘': ['é“¶','é’°','é”¦','ç™½','ç´ ','æ´','å‡€','æ¸…','çˆ½','é›ª','é“ƒ','é“­','é”','é”¶','é“±','é•˜','é“‚','é’—','é’','é’¤','é“„','é”˜','é•±','é”Œ','é”œ','é•Ÿ','é”¶','é”³','é’°','é”¦'],
                'æ°´': ['é›¨','é›ª','éœ²','äº‘','é›¾','æ¶¦','æ¹¿','æŸ”','è½¯','æ¸…','æ±','æ»¢','æ²','æ¹‰','æ³ ','æ²','æ³º','æµ£','æ¶“','æ¼ª','æ¹„','æ½‡','æ½','æ¾œ','æ¾„','æ½†','æ¾','æ¼©','æ»Ÿ','æ½‹']
            }
        };
    }

    // è®¡ç®—å­—çš„ç¬”ç”»æ•°ï¼ˆå®Œæ•´ç‰ˆï¼‰
    getCharStrokes(char) {
        // å®Œæ•´çš„æ±‰å­—ç¬”ç”»æ•°æ®åº“
        const strokesDatabase = {
            // æ•°å­—
            'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5, 'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9, 'å': 2,
            'é›¶': 13, 'ç™¾': 6, 'åƒ': 3, 'ä¸‡': 3,

            // å¸¸è§å§“æ°
            'ç‹': 4, 'æ': 7, 'å¼ ': 11, 'åˆ˜': 15, 'é™ˆ': 16, 'æ¨': 13, 'èµµ': 14, 'é»„': 12, 'å‘¨': 8, 'å´': 7,
            'å¾': 10, 'å­™': 6, 'èƒ¡': 9, 'æœ±': 6, 'é«˜': 10, 'æ—': 8, 'ä½•': 7, 'éƒ­': 15, 'é©¬': 10, 'ç½—': 19,
            'æ¢': 11, 'å®‹': 7, 'éƒ‘': 19, 'è°¢': 17, 'éŸ©': 17, 'å”': 10, 'å†¯': 12, 'äº': 3, 'è‘£': 15, 'è§': 18,
            'ç¨‹': 12, 'æ›¹': 11, 'è¢': 10, 'é‚“': 19, 'è®¸': 11, 'å‚…': 12, 'æ²ˆ': 7, 'æ›¾': 12, 'å½­': 12, 'å•': 7,
            'è‹': 22, 'å¢': 16, 'è’‹': 17, 'è”¡': 17, 'è´¾': 13, 'ä¸': 2, 'é­': 18, 'è–›': 19, 'å¶': 15, 'é˜': 16,
            'ä½™': 7, 'æ½˜': 16, 'æœ': 7, 'æˆ´': 18, 'å¤': 10, 'é’Ÿ': 17, 'æ±ª': 8, 'ç”°': 5, 'ä»»': 6, 'å§œ': 9,
            'èŒƒ': 15, 'æ–¹': 4, 'çŸ³': 5, 'å§š': 9, 'è°­': 19, 'å»–': 14, 'é‚¹': 17, 'ç†Š': 14, 'é‡‘': 8, 'é™†': 16,
            'éƒ': 14, 'å­”': 4, 'ç™½': 5, 'å´”': 11, 'åº·': 11, 'æ¯›': 4, 'é‚±': 12, 'ç§¦': 10, 'æ±Ÿ': 7, 'å²': 5,
            'é¡¾': 21, 'ä¾¯': 9, 'é‚µ': 12, 'å­Ÿ': 8, 'é¾™': 16, 'ä¸‡': 15, 'æ®µ': 9, 'æ¼•': 14, 'é’±': 16, 'æ±¤': 13,

            // æœ¨å±æ€§å­—
            'æ—': 8, 'æ£®': 12, 'æ ‘': 16, 'æ': 8, 'å¶': 15, 'èŠ±': 10, 'è‰': 12, 'ç«¹': 6, 'æ¾': 8, 'æŸ': 9,
            'æ¢…': 11, 'å…°': 23, 'èŠ': 14, 'è²': 17, 'è·': 13, 'èŠ³': 10, 'èŠ¬': 10, 'èŠ¸': 10, 'è‹—': 11, 'èŒ‚': 11,
            'è‹±': 11, 'å': 14, 'è“': 20, 'ç»¿': 14, 'é’': 8, 'æ°': 12, 'æ¥ ': 13, 'æ¢“': 11, 'æ¡': 10, 'æ ‹': 12,
            'å½¬': 11, 'æ¡‚': 10, 'æŸ³': 9, 'æ¦†': 13, 'æ§': 14, 'æ¡ƒ': 10, 'æ': 7, 'æ': 7, 'æ¢¨': 11, 'æ©˜': 16,
            'æŸ¿': 9, 'æ«': 13, 'æ¡”': 10, 'æŸš': 9, 'æ¦´': 14, 'æ¨±': 21, 'æ¡‰': 10, 'æŸ ': 18, 'æª¬': 17, 'æ¤°': 13,
            'æ£•': 12, 'æ¤¿': 13, 'æ§Ÿ': 14, 'æ¦”': 14, 'æ¡¦': 16, 'æ¨': 13, 'æŸ³': 9, 'æ¦•': 14, 'æ¢§': 11, 'æ¡': 10,
            'æ³': 9, 'æ¸': 9, 'æ': 7, 'æ¡‘': 10, 'æ¦†': 13, 'æ§¿': 15, 'æ£ ': 12, 'æ££': 12, 'æ¤´': 12, 'æ¦›': 14,
            'æ —': 10, 'æŸ': 9, 'æ ': 10, 'æ¤½': 13, 'æª€': 17, 'æ¥¸': 13, 'æ¢£': 11, 'æ¥': 13, 'æ¥®': 13, 'æ¦‰': 13,

            // ç«å±æ€§å­—
            'ç«': 4, 'ç‚': 8, 'ç„°': 12, 'çƒˆ': 10, 'çƒ­': 15, 'æš–': 13, 'é˜³': 17, 'å…‰': 6, 'æ˜': 8, 'äº®': 9,
            'è¾‰': 15, 'ç¿': 17, 'çƒ‚': 15, 'çº¢': 9, 'æœ±': 6, 'ä¸¹': 4, 'å½¤': 7, 'èµ¤': 7, 'æ™¨': 11, 'æ˜Š': 8,
            'æ˜•': 8, 'æ™“': 16, 'æ™–': 13, 'ç…Œ': 13, 'ç‚œ': 13, 'çƒ¨': 16, 'ç„•': 11, 'ç‚³': 9, 'çƒ½': 11, 'ç„¯': 12,
            'ç‚«': 9, 'ç‚¯': 9, 'çƒ': 19, 'ç† ': 15, 'ç‡ƒ': 16, 'ç‡': 16, 'ç‡Š': 16, 'ç‡š': 16, 'ç„±': 12, 'ç…œ': 13,
            'ç†¹': 16, 'ç‡§': 17, 'ç‡”': 16, 'ç‡Š': 16, 'ç‡¿': 18, 'çˆ': 19, 'çˆŸ': 20, 'çˆ¨': 29, 'çµ': 24, 'ç¿': 17,
            'çƒ‚': 15, 'ç¼': 7, 'ç‚™': 8, 'çƒ¤': 10, 'ç„™': 12, 'çƒ˜': 10, 'ç„–': 12, 'ç…': 13, 'ç‚’': 8, 'ç‚–': 9,
            'ç…®': 12, 'è’¸': 16, 'çƒ§': 16, 'ç„š': 12, 'ç‡ƒ': 16, 'ç‡¥': 17, 'ç‡': 16, 'ç‡ƒ': 16, 'ç‡§': 17, 'ç‡”': 16,

            // åœŸå±æ€§å­—
            'åœŸ': 3, 'åœ°': 6, 'å±±': 3, 'å²©': 8, 'çŸ³': 5, 'å²—': 7, 'å³°': 10, 'å²­': 17, 'å¤': 8, 'åŸ¹': 11,
            'åŸ': 10, 'å ¡': 12, 'å¢¨': 15, 'é»„': 12, 'æ£•': 12, 'è¤': 16, 'åš': 9, 'é‡': 9, 'ç¨³': 19, 'å®‰': 6,
            'å®': 14, 'é™': 16, 'å’Œ': 8, 'å¹³': 5, 'åš': 11, 'å›º': 8, 'å’': 18, 'å †': 11, 'å¡”': 13, 'å¢™': 17,
            'å¡': 8, 'å‘': 7, 'å': 7, 'å': 7, 'åª': 8, 'å¦': 8, 'å‚': 8, 'å‹': 9, 'åƒ': 8, 'åœ¾': 6,
            'åŸ‹': 10, 'åŸƒ': 10, 'åŸŸ': 11, 'å ¤': 12, 'å¡˜': 13, 'å¢“': 14, 'å¢': 15, 'å¢Ÿ': 15, 'å£': 16, 'å£¤': 20,
            'åœ³': 6, 'åœ©': 6, 'åœª': 6, 'åœ­': 6, 'åœ®': 5, 'åœ¯': 6, 'åœ°': 6, 'åœ³': 6, 'åœ¹': 7, 'åœº': 12,
            'åŠ': 7, 'å': 7, 'å': 7, 'å': 7, 'å': 7, 'å‘': 7, 'å—': 7, 'åš': 11, 'å›': 7, 'åœ': 8,

            // é‡‘å±æ€§å­—
            'é‡‘': 8, 'é“¶': 14, 'é“œ': 14, 'é“': 21, 'é’¢': 16, 'é”‹': 15, 'åˆ©': 7, 'åˆ€': 2, 'å‰‘': 15, 'é’Ÿ': 17,
            'é“ƒ': 13, 'é”¦': 16, 'é’°': 13, 'é‘«': 24, 'ç™½': 5, 'ç´ ': 10, 'æ´': 16, 'å‡€': 8, 'æ¸…': 12, 'çˆ½': 11,
            'åˆš': 10, 'å¼º': 12, 'åš': 11, 'ç¡¬': 12, 'é”': 15, 'é“­': 14, 'é’Š': 10, 'é’§': 12, 'é“¨': 14, 'é“¶': 14,
            'é“¸': 14, 'é“¾': 16, 'é”': 18, 'é”¤': 16, 'é”¯': 16, 'é”¹': 16, 'é”»': 17, 'é•€': 18, 'é•‡': 18, 'é•œ': 19,
            'é’‰': 10, 'é’“': 11, 'é’—': 11, 'é’™': 11, 'é’›': 11, 'é’œ': 12, 'é’': 12, 'é’': 12, 'é’Ÿ': 17, 'é’ ': 11,
            'é’¢': 16, 'é’£': 11, 'é’¤': 11, 'é’¥': 11, 'é’¦': 12, 'é’§': 12, 'é’¨': 12, 'é’©': 12, 'é’ª': 11, 'é’«': 11,
            'é’¬': 11, 'é’­': 11, 'é’®': 12, 'é’¯': 12, 'é’°': 13, 'é’±': 16, 'é’²': 13, 'é’³': 13, 'é’´': 13, 'é’µ': 13,

            // æ°´å±æ€§å­—
            'æ°´': 4, 'æ±Ÿ': 7, 'æ²³': 9, 'æ¹–': 13, 'æµ·': 11, 'æ³¢': 9, 'æµª': 11, 'æµ': 10, 'æºª': 14, 'æ³‰': 9,
            'é›¨': 8, 'é›ª': 11, 'å†°': 6, 'éœœ': 17, 'éœ²': 21, 'äº‘': 12, 'é›¾': 19, 'é»‘': 12, 'è“': 20, 'æ·±': 12,
            'æ¶¦': 16, 'æ¹¿': 17, 'æŸ”': 9, 'è½¯': 11, 'æ¶›': 18, 'æ³½': 17, 'æ´‹': 10, 'æµ©': 11, 'æ¸Š': 12, 'æ·¼': 12,
            'æ²': 8, 'æ²‚': 8, 'æ²ƒ': 8, 'æ²…': 8, 'æ²†': 8, 'æ²ˆ': 7, 'æ²‰': 8, 'æ²': 8, 'æ²™': 8, 'æ²›': 8,
            'æ²³': 9, 'æ²»': 9, 'æ²¼': 9, 'æ²½': 9, 'æ²¾': 9, 'æ²¿': 9, 'æ³‚': 8, 'æ³ƒ': 9, 'æ³„': 9, 'æ³…': 9,
            'æ³†': 9, 'æ³‡': 9, 'æ³ˆ': 9, 'æ³‰': 9, 'æ³Š': 9, 'æ³Œ': 9, 'æ³': 9, 'æ³': 9, 'æ³': 9, 'æ³': 9,
            'æ³‘': 9, 'æ³’': 9, 'æ³“': 9, 'æ³”': 9, 'æ³•': 9, 'æ³–': 9, 'æ³—': 9, 'æ³˜': 9, 'æ³™': 9, 'æ³š': 9,

            // å¸¸ç”¨èµ·åå­—
            'æ–‡': 4, 'æ­¦': 8, 'å¾·': 15, 'ä»': 4, 'ä¹‰': 13, 'ç¤¼': 18, 'æ™º': 12, 'ä¿¡': 9, 'å¿ ': 8, 'å­': 7,
            'å»‰': 13, 'è€»': 10, 'æ¸©': 13, 'è‰¯': 7, 'æ­': 10, 'ä¿­': 15, 'è®©': 24, 'æ…ˆ': 14, 'çˆ±': 13, 'æ•¬': 13,
            'è¯š': 14, 'è°¦': 17, 'å’Œ': 8, 'ç¦': 13, 'å‹': 4, 'å–„': 12, 'ç¾': 9, 'å¥½': 6, 'ä¼˜': 17, 'ç§€': 7,
            'æ‰': 4, 'å': 14, 'å¯Œ': 12, 'è´µ': 12, 'è£': 14, 'æ˜¾': 23, 'è¾¾': 16, 'æˆ': 7, 'åŠŸ': 5,
            'ç«‹': 5, 'ä¸š': 13, 'å»º': 9, 'è®¾': 11, 'åˆ›': 12, 'æ–°': 13, 'è¿›': 15, 'æ­¥': 7, 'å‘': 12, 'å±•': 10,
            'å…´': 16, 'æ—º': 8, 'ç››': 12, 'æ˜Œ': 8, 'éš†': 17, 'æ³°': 9, 'å®‰': 6, 'åº·': 11, 'å¥': 11, 'å¯¿': 14,
            'ç¦': 14, 'ç¦„': 13, 'å–œ': 12, 'è´¢': 10, 'è¿': 16, 'äº¨': 7, 'é€š': 14, 'é¡º': 12, 'åˆ©': 7,
            'å‰': 6, 'ç¥¥': 11, 'å¦‚': 6, 'æ„': 13, 'ç§°': 14, 'å¿ƒ': 4, 'æ»¡': 15, 'è¶³': 7, 'å¿«': 8, 'ä¹': 15,
            'å¹¸': 8, 'åœ†': 13, 'å ‚': 11, 'çº¢': 9, 'è…¾': 20, 'é£': 9, 'ç¿±': 18, 'ç¿”': 12, 'å±•': 10, 'ç¿…': 17,
            'é«˜': 10, 'è¿œ': 17, 'èˆª': 10, 'è¡Œ': 6, 'å–': 8, 'å¥‹': 16, 'æ–—': 4, 'æ‹¼': 10, 'æ': 14,
            'åŠª': 7, 'åŠ›': 2, 'å‹¤': 13, 'åˆ»': 8, 'è‹¦': 11, 'è®¤': 14, 'çœŸ': 10, 'ä¸“': 11,
            'è‡´': 15, 'å¿—': 7, 'æŒ': 10, 'æ’': 10, 'æ¯…': 15, 'å‹‡': 9, 'æ•¢': 12,
            'æœ': 8, 'æ–­': 18, 'å†³': 7, 'å¿µ': 8, 'ç†': 12, 'æƒ³': 13, 'ç›®': 5, 'æ ‡': 15,
            'æ–¹': 4, 'å‘': 6, 'é“': 16, 'è·¯': 13, 'é€”': 14, 'å¾„': 10, 'æ¡¥': 16, 'æ¢': 11, 'é˜¶': 12, 'æ¢¯': 11,

            // æ›´å¤šå¸¸ç”¨å­—
            'å¤©': 4, 'åœ°': 6, 'äºº': 2, 'ä¸­': 4, 'å›½': 11, 'å®¶': 10, 'å­¦': 16, 'ç”Ÿ': 5, 'ä¼š': 13, 'å¹´': 6,
            'æ—¶': 10, 'æ—¥': 4, 'æœˆ': 4, 'æ˜Ÿ': 9, 'è¾°': 7, 'å®‡': 6, 'å®™': 8, 'ä¸–': 5, 'ç•Œ': 9, 'ä¸‡': 15,
            'åƒ': 3, 'ç™¾': 6, 'å': 2, 'ä¸ª': 10, 'ç¬¬': 11, 'æ¬¡': 6, 'æ¯': 7, 'éƒ½': 16, 'å¾ˆ': 9, 'æœ€': 12,
            'æ›´': 7, 'è¿˜': 16, 'ä¹Ÿ': 3, 'å°±': 12, 'åª': 5, 'èƒ½': 10, 'è¦': 9, 'ä¼š': 13, 'å¯': 5, 'ä»¥': 5,
            'ä¸Š': 3, 'ä¸‹': 3, 'å‰': 9, 'å': 9, 'å·¦': 5, 'å³': 5, 'ä¸œ': 8, 'å—': 9, 'è¥¿': 6, 'åŒ—': 5,
            'é‡Œ': 13, 'å¤–': 5, 'å†…': 4, 'è¾¹': 22, 'é¢': 9, 'å¤´': 16, 'å°¾': 7, 'èº«': 7, 'æ‰‹': 4, 'è„š': 13,
            'çœ¼': 11, 'è€³': 6, 'é¼»': 14, 'å£': 3, 'ç‰™': 4, 'èˆŒ': 6, 'å¤´': 16, 'å‘': 12, 'è„¸': 17, 'é¢œ': 18,
            'è‰²': 6, 'é»‘': 12, 'ç™½': 5, 'çº¢': 9, 'ç»¿': 14, 'è“': 20, 'é»„': 12, 'ç´«': 12, 'ç²‰': 10, 'ç°': 6,
            'å¤§': 3, 'å°': 3, 'é•¿': 8, 'çŸ­': 12, 'é«˜': 10, 'ä½': 7, 'å®½': 15, 'çª„': 10, 'åš': 9, 'è–„': 16,
            'æ·±': 12, 'æµ…': 11, 'é‡': 9, 'è½»': 14, 'å¿«': 8, 'æ…¢': 15, 'æ—©': 6, 'æ™š': 12, 'æ–°': 13, 'æ—§': 18,
            'å¤š': 6, 'å°‘': 4, 'å…¨': 6, 'åŠ': 5, 'ç©º': 8, 'æ»¡': 15, 'å‡€': 8, 'è„': 11, 'å¹²': 3, 'æ¹¿': 17,
            'å†·': 7, 'çƒ­': 15, 'æ¸©': 13, 'å‡‰': 10, 'æš–': 13, 'äº®': 9, 'æš—': 13, 'æ˜': 8, 'æ¸…': 12, 'æµŠ': 11,
            'ç”œ': 11, 'è‹¦': 11, 'é…¸': 14, 'è¾£': 14, 'å’¸': 9, 'æ·¡': 12, 'é¦™': 9, 'è‡­': 10, 'å¥½': 6, 'å': 7,
            'å¯¹': 14, 'é”™': 16, 'æ˜¯': 9, 'é': 8, 'çœŸ': 10, 'å‡': 11, 'æ­£': 5, 'å': 4, 'ç›´': 8, 'å¼¯': 9,
            'åœ†': 13, 'æ–¹': 4, 'å°–': 6, 'å¹³': 5, 'æ–œ': 11, 'æ¨ª': 16, 'ç«–': 9, 'ç²—': 11, 'ç»†': 11, 'å°–': 6,
            'é’': 12, 'é”‹': 15, 'åˆ©': 7, 'é’': 12, 'ç¡¬': 12, 'è½¯': 11, 'è„†': 10, 'éŸ§': 12, 'æ»‘': 13, 'ç²—': 11,
            'ç³™': 16, 'å…‰': 6, 'æ»‘': 13, 'æ¯›': 4, 'ç³™': 16, 'å¹³': 5, 'å‡¸': 5, 'å‡¹': 5, 'ç›´': 8, 'å¼¯': 9,
            'æ›²': 6, 'æŠ˜': 7, 'æ–­': 18, 'è¿': 14, 'æ¥': 11, 'åˆ†': 4, 'åˆ': 6, 'å¼€': 12, 'å…³': 6, 'è¿›': 15,
            'å‡º': 5, 'å…¥': 2, 'å›': 6, 'å»': 5, 'æ¥': 8, 'åˆ°': 11, 'ä»': 11, 'å‘': 6, 'å¾€': 8, 'è¿‡': 12,
            'ç»': 13, 'é€š': 14, 'è¾¾': 16, 'è¿‘': 11, 'è¿œ': 17, 'å†…': 4, 'å¤–': 5, 'ä¸­': 4, 'é—´': 12, 'æ—': 10,
            'è¾¹': 22, 'è§’': 7, 'å¤„': 5, 'æ‰€': 8, 'ä½': 7, 'ç½®': 13, 'ç‚¹': 17, 'çº¿': 15, 'é¢': 9, 'ä½“': 7,
            'å½¢': 7, 'çŠ¶': 7, 'æ ·': 15, 'ç§': 14, 'ç±»': 9, 'åˆ«': 7, 'åŒ': 6, 'å¼‚': 11, 'ä¼¼': 6, 'åƒ': 14,
            'ç­‰': 12, 'çº§': 9, 'å±‚': 7, 'æ¬¡': 6, 'ç¬¬': 11, 'åº': 7, 'å·': 13, 'ç ': 8, 'å': 6, 'ç§°': 14,
            'å­—': 6, 'è¯': 12, 'å¥': 5, 'æ®µ': 9, 'ç« ': 11, 'èŠ‚': 13, 'ç¯‡': 15, 'é¡µ': 9, 'æœ¬': 5, 'å†Œ': 8,
            'å·': 8, 'é›†': 12, 'å¥—': 10, 'éƒ¨': 11, 'åˆ†': 4, 'åŠ': 5, 'å…¨': 6, 'æ•´': 16, 'é›¶': 13, 'å•': 12,
            'åŒ': 18, 'å¯¹': 14, 'å‰¯': 11, 'å¥—': 10, 'ç»„': 11, 'ç¾¤': 13, 'é˜Ÿ': 12, 'ç­': 10, 'çº§': 9, 'å¹´': 6
        };

        return strokesDatabase[char] || this.calculateStrokesByRadical(char);
    }

    // æ ¹æ®éƒ¨é¦–æ¨ç®—ç¬”ç”»æ•°ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
    calculateStrokesByRadical(char) {
        // ä¼˜åŒ–ç¬”ç”»ä¼°ç®—ï¼šç»“åˆUnicodeåŒºå—å’Œå¸¸è§ç»“æ„
        const code = char.charCodeAt(0);
        
        // CJKç»Ÿä¸€æ±‰å­—åŒº (4E00-9FFF)
        if (code >= 0x4E00 && code <= 0x9FFF) {
            // æ›´ç²¾ç¡®çš„ç¬”ç”»ä¼°ç®—æ¨¡å‹
            const strokeRanges = [
                [0x4E00, 0x4F00, 1, 5],   // ç®€å•å­—
                [0x4F00, 0x5500, 5, 8],   // ä¸­ç­‰å­—
                [0x5500, 0x6000, 8, 10],  // è¾ƒå¤æ‚å­—
                [0x6000, 0x9FFF, 10, 20] // å¤æ‚å­—
            ];
            
            for (const [start, end, min, max] of strokeRanges) {
                if (code >= start && code < end) {
                    return Math.floor((code - start) / ((end - start) / (max - min))) + min;
                }
            }
        }
        
        // æ‰©å±•å…¼å®¹åŒº (3400-4DBF)
        if (code >= 0x3400 && code <= 0x4DBF) {
            return 10; // ç”Ÿåƒ»å­—é»˜è®¤10ç”»
        }
        
        return 8; // éæ±‰å­—å­—ç¬¦é»˜è®¤8ç”»
    }

    // è®¡ç®—äº”æ ¼æ•°ç†ï¼ˆä¿®æ­£ç‰ˆï¼‰
    calculateWuGe(surname, firstName) {
        // å¤„ç†å¤å§“æƒ…å†µï¼ˆå¦‚"æ¬§é˜³"ç­‰ï¼‰
        const isCompoundSurname = surname.length > 1;
        
        // è®¡ç®—å§“æ°æ€»ç¬”ç”»ï¼ˆåŒºåˆ†å•å§“/å¤å§“ï¼‰
        const surnameStrokes = surname.split('').reduce((sum, char) => sum + this.getCharStrokes(char), 0);
        
        // è®¡ç®—åå­—æ€»ç¬”ç”»
        const firstNameStrokes = firstName.split('').reduce((sum, char) => sum + this.getCharStrokes(char), 0);
        
        // å¤©æ ¼ï¼šå•å§“+1ï¼Œå¤å§“ç›´æ¥å–å’Œ
        const tianGe = isCompoundSurname ? surnameStrokes : surnameStrokes + 1;
        
        // äººæ ¼ï¼šå§“æ°æœ«å­— + åå­—é¦–å­—
        const surnameLastChar = surname.slice(-1);
        const nameFirstChar = firstName[0] || '';
        const renGe = this.getCharStrokes(surnameLastChar) + (nameFirstChar ? this.getCharStrokes(nameFirstChar) : 0);
        
        // åœ°æ ¼ï¼šåå­—ç¬”ç”»å’Œï¼ˆå•åæ—¶+1ï¼‰
        const diGe = firstName.length === 1 ? 
            this.getCharStrokes(firstName) + 1 : 
            firstNameStrokes;
        
        // æ€»æ ¼ï¼šå§“+åæ€»ç¬”ç”»
        const zongGe = surnameStrokes + firstNameStrokes;
        
        // å¤–æ ¼ï¼šåŒºåˆ†å•å§“/å¤å§“å’Œå•å/åŒå
        let waiGe;
        if (isCompoundSurname) {
            waiGe = firstName.length === 1 ? 
                zongGe - renGe + 1 :  // å¤å§“å•å
                zongGe - renGe;       // å¤å§“åŒå
        } else {
            waiGe = firstName.length === 1 ? 
                2 :                   // å•å§“å•å
                zongGe - renGe + 1;   // å•å§“åŒå
        }
        
        return {
            tianGe,
            renGe,
            diGe,
            waiGe,
            zongGe
        };
    }

    // è®¡ç®—ä¸‰æ‰é…ç½®ï¼ˆä¿®æ­£ç‰ˆï¼‰
    calculateSanCai(wuGe) {
        const { tianGe, renGe, diGe } = wuGe;
        
        // ä¿®æ­£äº”è¡Œè½¬æ¢è§„åˆ™ï¼ˆæŒ‰ä¸ªä½æ•°å¯¹åº”ï¼‰
        const getWuXingFromNumber = (num) => {
            const lastDigit = num % 10;
            // 1/2å±æœ¨ï¼Œ3/4å±ç«ï¼Œ5/6å±åœŸï¼Œ7/8å±é‡‘ï¼Œ9/0å±æ°´
            return ['æœ¨', 'æœ¨', 'ç«', 'ç«', 'åœŸ', 'åœŸ', 'é‡‘', 'é‡‘', 'æ°´', 'æ°´'][lastDigit];
        };
        
        const tianWuXing = getWuXingFromNumber(tianGe);
        const renWuXing = getWuXingFromNumber(renGe);
        const diWuXing = getWuXingFromNumber(diGe);
        
        // äº”è¡Œæ•°å­—ç¼–ç 
        const wuXingToNum = { 'æœ¨': 1, 'ç«': 2, 'åœŸ': 3, 'é‡‘': 4, 'æ°´': 5 };
        const sanCaiCode = `${wuXingToNum[tianWuXing]}${wuXingToNum[renWuXing]}${wuXingToNum[diWuXing]}`;
        
        // æ·»åŠ é»˜è®¤å€¼å¤„ç†
        return {
            tianWuXing,
            renWuXing,
            diWuXing,
            sanCaiCode,
            jiXiong: this.sanCaiTable[sanCaiCode] || 'å¹³'
        };
    }

    // åˆ†æå…«å­—äº”è¡Œéœ€æ±‚
    analyzeBaziWuXing(baziResult) {
        // è·å–å…«å­—ä¸­çš„äº”è¡Œåˆ†å¸ƒ
        const wuxingCount = { 'æœ¨': 0, 'ç«': 0, 'åœŸ': 0, 'é‡‘': 0, 'æ°´': 0 };

        // ç»Ÿè®¡å…«å­—ä¸­å„äº”è¡Œçš„æ•°é‡
        if (baziResult.wuxingInfo) {
            ['year', 'month', 'day', 'hour'].forEach(pillar => {
                const pillarInfo = baziResult.wuxingInfo[pillar];
                if (pillarInfo) {
                    wuxingCount[pillarInfo.tianGan]++;
                    wuxingCount[pillarInfo.diZhi]++;
                }
            });
        } else {
            // å¤‡ç”¨æ–¹æ³•ï¼šç›´æ¥ä»å››æŸ±å­—ç¬¦ä¸²åˆ†æ
            const pillars = [baziResult.yearPillar, baziResult.monthPillar, baziResult.dayPillar, baziResult.hourPillar];
            pillars.forEach(pillar => {
                if (pillar && pillar.length === 2) {
                    const tianGan = pillar[0];
                    const diZhi = pillar[1];
                    const tianGanWuXing = this.getCharWuXingFromTianGan(tianGan);
                    const diZhiWuXing = this.getCharWuXingFromDiZhi(diZhi);
                    if (tianGanWuXing) wuxingCount[tianGanWuXing]++;
                    if (diZhiWuXing) wuxingCount[diZhiWuXing]++;
                }
            });
        }

        // æ‰¾å‡ºæœ€å¼±çš„äº”è¡Œï¼ˆéœ€è¦è¡¥å……çš„ï¼‰
        const dayTianGan = baziResult.dayTianGan;
        const dayWuXing = this.getCharWuXingFromTianGan(dayTianGan);

        // åˆ†æäº”è¡Œå¼ºå¼±ï¼Œç¡®å®šéœ€è¦è¡¥å……çš„äº”è¡Œ
        const neededWuXing = [];

        // 1. å¦‚æœæ—¥å…ƒäº”è¡Œåå¼±ï¼Œä¼˜å…ˆè¡¥å……æ—¥å…ƒäº”è¡Œå’Œç”Ÿæ—¥å…ƒçš„äº”è¡Œ
        const dayWuXingCount = wuxingCount[dayWuXing] || 0;
        if (dayWuXingCount <= 2) {
            neededWuXing.push(dayWuXing); // è¡¥å……æ—¥å…ƒäº”è¡Œ
            const generateDayWuXing = this.getGenerateWuXing(dayWuXing);
            if (generateDayWuXing) {
                neededWuXing.push(generateDayWuXing); // è¡¥å……ç”Ÿæ—¥å…ƒçš„äº”è¡Œ
            }
        }

        // 2. æ‰¾å‡ºå…«å­—ä¸­æœ€ç¼ºçš„äº”è¡Œï¼ˆç¡®ä¿æ’åºç¨³å®šæ€§ï¼‰
        const sortedWuXing = Object.entries(wuxingCount)
            .sort((a, b) => {
                // é¦–å…ˆæŒ‰æ•°é‡æ’åº
                if (a[1] !== b[1]) {
                    return a[1] - b[1];
                }
                // æ•°é‡ç›¸åŒæ—¶æŒ‰äº”è¡Œé¡ºåºæ’åºï¼Œç¡®ä¿ç»“æœä¸€è‡´
                const wuxingOrder = ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'];
                return wuxingOrder.indexOf(a[0]) - wuxingOrder.indexOf(b[0]);
            })
            .map(item => item[0]);

        // æ·»åŠ æœ€ç¼ºçš„1-2ä¸ªäº”è¡Œ
        sortedWuXing.slice(0, 2).forEach(wuXing => {
            if (!neededWuXing.includes(wuXing)) {
                neededWuXing.push(wuXing);
            }
        });

        // ç¡®ä¿è‡³å°‘è¿”å›ä¸¤ä¸ªäº”è¡Œ
        if (neededWuXing.length === 0) {
            return [dayWuXing, this.getGenerateWuXing(dayWuXing) || 'æœ¨'];
        } else if (neededWuXing.length === 1) {
            const generateWuXing = this.getGenerateWuXing(neededWuXing[0]);
            if (generateWuXing && !neededWuXing.includes(generateWuXing)) {
                neededWuXing.push(generateWuXing);
            } else {
                // ä»æ’åºåçš„äº”è¡Œä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸åœ¨neededWuXingä¸­çš„äº”è¡Œ
                for (const wuXing of sortedWuXing) {
                    if (!neededWuXing.includes(wuXing)) {
                        neededWuXing.push(wuXing);
                        break;
                    }
                }
            }
        }

        return neededWuXing.slice(0, 3); // æœ€å¤šè¿”å›3ä¸ªäº”è¡Œ
    }

    // è·å–å¤©å¹²å¯¹åº”çš„äº”è¡Œ
    getCharWuXingFromTianGan(tianGan) {
        const tianGanWuXing = {
            'ç”²': 'æœ¨', 'ä¹™': 'æœ¨', 'ä¸™': 'ç«', 'ä¸': 'ç«', 'æˆŠ': 'åœŸ',
            'å·±': 'åœŸ', 'åºš': 'é‡‘', 'è¾›': 'é‡‘', 'å£¬': 'æ°´', 'ç™¸': 'æ°´'
        };
        return tianGanWuXing[tianGan];
    }

    // è·å–åœ°æ”¯å¯¹åº”çš„äº”è¡Œ
    getCharWuXingFromDiZhi(diZhi) {
        const diZhiWuXing = {
            'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ',
            'å·³': 'ç«', 'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘',
            'æˆŒ': 'åœŸ', 'äº¥': 'æ°´'
        };
        return diZhiWuXing[diZhi];
    }

    // è·å–ç”ŸæŸäº”è¡Œçš„äº”è¡Œ
    getGenerateWuXing(wuXing) {
        const generateMap = {
            'æœ¨': 'æ°´', // æ°´ç”Ÿæœ¨
            'ç«': 'æœ¨', // æœ¨ç”Ÿç«
            'åœŸ': 'ç«', // ç«ç”ŸåœŸ
            'é‡‘': 'åœŸ', // åœŸç”Ÿé‡‘
            'æ°´': 'é‡‘'  // é‡‘ç”Ÿæ°´
        };
        return generateMap[wuXing];
    }

    // ç”Ÿæˆåå­—å»ºè®®
    generateNameSuggestions(surname, gender, baziResult, customConfig = {}) {
        const neededWuXing = this.analyzeBaziWuXing(baziResult);
        const suggestions = [];

        const { firstChar, secondChar, candidateChars = [] } = customConfig;

        // è·å–é€‚åˆçš„å­—
        const getGoodChars = (wuXing) => {
            const genderChars = this.goodChars[gender] || this.goodChars['ç”·'];
            const wuXingChars = genderChars[wuXing] || [];
            // å¦‚æœæœ‰å€™é€‰å­—åº“ï¼Œä¼˜å…ˆä½¿ç”¨å€™é€‰å­—ä¸­ç¬¦åˆäº”è¡Œçš„å­—
            const candidateWuXingChars = candidateChars.filter(char => this.isCharWuXing(char, wuXing));
            if (candidateWuXingChars.length > 0) {
                return [...candidateWuXingChars, ...wuXingChars.slice(0, 3)];
            }
            return wuXingChars;
        };

        // ç”Ÿæˆè‡ªå®šä¹‰å­—ç»„åˆ
        const getCustomCombinations = () => {
            const customSuggestions = [];

            // æƒ…å†µ1ï¼šæŒ‡å®šäº†ç¬¬ä¸€ä¸ªå­—
            if (firstChar) {
                const firstCharWuXing = this.getCharWuXing(firstChar);

                // å¦‚æœä¹ŸæŒ‡å®šäº†ç¬¬äºŒä¸ªå­—
                if (secondChar) {
                    const secondCharWuXing = this.getCharWuXing(secondChar);
                    const firstName = firstChar + secondChar;
                    const fullName = surname + firstName;

                    const wuGe = this.calculateWuGe(surname, firstName);
                    const sanCai = this.calculateSanCai(wuGe);
                    const score = this.calculateNameScore(wuGe, sanCai);

                    customSuggestions.push({
                        fullName,
                        firstName,
                        wuGe,
                        sanCai,
                        score: score + 10, // å®Œå…¨æŒ‡å®šå­—åŠ æ›´å¤šåˆ†
                        wuXingMatch: [firstCharWuXing, secondCharWuXing],
                        isCustom: true,
                        customType: 'å®Œå…¨æŒ‡å®š'
                    });
                } else {
                    // åªæŒ‡å®šç¬¬ä¸€ä¸ªå­—ï¼Œç¬¬äºŒä¸ªå­—ä»å€™é€‰å­—åº“æˆ–ç³»ç»Ÿæ¨èä¸­é€‰æ‹©
                    const secondChars = candidateChars.length > 0 ? candidateChars : [];
                    if (secondChars.length === 0) {
                        // å¦‚æœæ²¡æœ‰å€™é€‰å­—ï¼Œä»éœ€è¦çš„äº”è¡Œä¸­é€‰æ‹©
                        neededWuXing.forEach(wuXing => {
                            const chars = getGoodChars(wuXing);
                            secondChars.push(...chars.slice(0, 3));
                        });
                    }

                    secondChars.forEach(char => {
                        const secondCharWuXing = this.getCharWuXing(char);
                        const firstName = firstChar + char;
                        const fullName = surname + firstName;

                        const wuGe = this.calculateWuGe(surname, firstName);
                        const sanCai = this.calculateSanCai(wuGe);
                        const score = this.calculateNameScore(wuGe, sanCai);

                        customSuggestions.push({
                            fullName,
                            firstName,
                            wuGe,
                            sanCai,
                            score: score + 8, // æŒ‡å®šç¬¬ä¸€ä¸ªå­—åŠ åˆ†
                            wuXingMatch: [firstCharWuXing, secondCharWuXing],
                            isCustom: true,
                            customType: 'æŒ‡å®šé¦–å­—'
                        });
                    });
                }
            }
            // æƒ…å†µ2ï¼šåªæŒ‡å®šäº†ç¬¬äºŒä¸ªå­—
            else if (secondChar) {
                const secondCharWuXing = this.getCharWuXing(secondChar);
                const firstChars = candidateChars.length > 0 ? candidateChars : [];
                if (firstChars.length === 0) {
                    // å¦‚æœæ²¡æœ‰å€™é€‰å­—ï¼Œä»éœ€è¦çš„äº”è¡Œä¸­é€‰æ‹©
                    neededWuXing.forEach(wuXing => {
                        const chars = getGoodChars(wuXing);
                        firstChars.push(...chars.slice(0, 3));
                    });
                }

                firstChars.forEach(char => {
                    const firstCharWuXing = this.getCharWuXing(char);
                    const firstName = char + secondChar;
                    const fullName = surname + firstName;

                    const wuGe = this.calculateWuGe(surname, firstName);
                    const sanCai = this.calculateSanCai(wuGe);
                    const score = this.calculateNameScore(wuGe, sanCai);

                    customSuggestions.push({
                        fullName,
                        firstName,
                        wuGe,
                        sanCai,
                        score: score + 8, // æŒ‡å®šç¬¬äºŒä¸ªå­—åŠ åˆ†
                        wuXingMatch: [firstCharWuXing, secondCharWuXing],
                        isCustom: true,
                        customType: 'æŒ‡å®šæœ«å­—'
                    });
                });
            }
            // æƒ…å†µ3ï¼šåªæœ‰å€™é€‰å­—åº“ï¼Œç”Ÿæˆå€™é€‰å­—çš„ç»„åˆ
            else if (candidateChars.length >= 2) {
                for (let i = 0; i < candidateChars.length; i++) {
                    for (let j = 0; j < candidateChars.length; j++) {
                        if (i !== j) {
                            const char1 = candidateChars[i];
                            const char2 = candidateChars[j];
                            const firstName = char1 + char2;
                            const fullName = surname + firstName;

                            const wuGe = this.calculateWuGe(surname, firstName);
                            const sanCai = this.calculateSanCai(wuGe);
                            const score = this.calculateNameScore(wuGe, sanCai);

                            const char1WuXing = this.getCharWuXing(char1);
                            const char2WuXing = this.getCharWuXing(char2);

                            customSuggestions.push({
                                fullName,
                                firstName,
                                wuGe,
                                sanCai,
                                score: score + 5, // å€™é€‰å­—ç»„åˆåŠ åˆ†
                                wuXingMatch: [char1WuXing, char2WuXing],
                                isCustom: true,
                                customType: 'å€™é€‰å­—ç»„åˆ'
                            });
                        }
                    }
                }
            }

            return customSuggestions;
        };
        
        // é¦–å…ˆæ·»åŠ è‡ªå®šä¹‰å­—ç»„åˆ
        const customSuggestions = getCustomCombinations();
        suggestions.push(...customSuggestions);

        // å¦‚æœè‡ªå®šä¹‰å»ºè®®ä¸è¶³10ä¸ªï¼Œç»§ç»­ç”ŸæˆåŸºäºäº”è¡Œéœ€æ±‚çš„å»ºè®®
        if (suggestions.length < 10) {
            neededWuXing.forEach(wuXing1 => {
                neededWuXing.forEach(wuXing2 => {
                    const chars1 = getGoodChars(wuXing1);
                    const chars2 = getGoodChars(wuXing2);

                    for (let i = 0; i < Math.min(3, chars1.length); i++) {
                        for (let j = 0; j < Math.min(3, chars2.length); j++) {
                            const firstName = chars1[i] + chars2[j];
                            const fullName = surname + firstName;

                            // é¿å…é‡å¤ï¼ˆå¦‚æœå·²ç»åœ¨è‡ªå®šä¹‰å»ºè®®ä¸­ï¼‰
                            if (suggestions.some(s => s.fullName === fullName)) {
                                continue;
                            }

                            const wuGe = this.calculateWuGe(surname, firstName);
                            const sanCai = this.calculateSanCai(wuGe);
                            const score = this.calculateNameScore(wuGe, sanCai);

                            suggestions.push({
                                fullName,
                                firstName,
                                wuGe,
                                sanCai,
                                score,
                                wuXingMatch: [wuXing1, wuXing2],
                                isCustom: false,
                                customType: 'ç³»ç»Ÿæ¨è'
                            });
                        }
                    }
                });
            });
        }

        // æŒ‰åˆ†æ•°æ’åºï¼Œè‡ªå®šä¹‰å­—ä¼˜å…ˆï¼Œç„¶åè¿”å›å‰10ä¸ªï¼ˆç¡®ä¿æ’åºç¨³å®šæ€§ï¼‰
        return suggestions
            .sort((a, b) => {
                // è‡ªå®šä¹‰å­—ä¼˜å…ˆ
                if (a.isCustom && !b.isCustom) return -1;
                if (!a.isCustom && b.isCustom) return 1;
                // åœ¨è‡ªå®šä¹‰å­—ä¸­ï¼Œå®Œå…¨æŒ‡å®šçš„ä¼˜å…ˆ
                if (a.isCustom && b.isCustom) {
                    const priority = { 'å®Œå…¨æŒ‡å®š': 3, 'æŒ‡å®šé¦–å­—': 2, 'æŒ‡å®šæœ«å­—': 2, 'å€™é€‰å­—ç»„åˆ': 1 };
                    const aPriority = priority[a.customType] || 0;
                    const bPriority = priority[b.customType] || 0;
                    if (aPriority !== bPriority) return bPriority - aPriority;
                }
                // åˆ†æ•°æ’åº
                if (a.score !== b.score) {
                    return b.score - a.score;
                }
                // åˆ†æ•°ç›¸åŒæ—¶æŒ‰å§“åå­—å…¸åºæ’åºï¼Œç¡®ä¿ç»“æœä¸€è‡´
                return a.fullName.localeCompare(b.fullName);
            })
            .slice(0, 10);
    }

    // åˆ¤æ–­å­—çš„äº”è¡Œå±æ€§
    isCharWuXing(char, wuXing) {
        return this.charWuXing[wuXing] && this.charWuXing[wuXing].includes(char);
    }

    // è·å–å•ä¸ªå­—çš„äº”è¡Œå±æ€§
    getCharWuXing(char) {
        // æŒ‰å›ºå®šé¡ºåºéå†äº”è¡Œï¼Œç¡®ä¿ç»“æœä¸€è‡´
        const wuxingOrder = ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'];
        for (const wuXing of wuxingOrder) {
            const chars = this.charWuXing[wuXing];
            if (chars && chars.includes(char)) {
                return wuXing;
            }
        }
        // å¦‚æœæ‰¾ä¸åˆ°ï¼Œæ ¹æ®å­—çš„ç¬”ç”»æ•°æ¨ç®—äº”è¡Œ
        const strokes = this.getCharStrokes(char);
        const wuXingByStrokes = ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'];
        return wuXingByStrokes[strokes % 5];
    }

    // è®¡ç®—å§“åæ€»åˆ†
    calculateNameScore(wuGe, sanCai) {
        let score = 60; // åŸºç¡€åˆ†

        // äº”æ ¼è¯„åˆ†ï¼ˆæŒ‰å›ºå®šé¡ºåºéå†ï¼Œç¡®ä¿ç»“æœä¸€è‡´ï¼‰
        const geOrder = ['tianGe', 'renGe', 'diGe', 'waiGe', 'zongGe'];
        geOrder.forEach(geName => {
            const ge = wuGe[geName];
            if (ge % 2 === 1) score += 2; // å¥‡æ•°åŠ åˆ†
            if (ge > 10 && ge < 30) score += 3; // é€‚ä¸­ç¬”ç”»åŠ åˆ†
        });

        // ä¸‰æ‰é…ç½®è¯„åˆ†
        switch (sanCai.jiXiong) {
            case 'å¤§å‰': score += 20; break;
            case 'å‰': score += 10; break;
            case 'ä¸­ç­‰': score += 5; break;
            case 'å‡¶': score -= 10; break;
        }

        return Math.min(100, Math.max(0, score));
    }

    // åˆ†æç°æœ‰å§“å
    analyzeName(fullName, baziResult) {
        if (fullName.length < 2) {
            throw new Error('å§“åé•¿åº¦ä¸è¶³');
        }
        
        const surname = fullName[0];
        const firstName = fullName.slice(1);
        
        const wuGe = this.calculateWuGe(surname, firstName);
        const sanCai = this.calculateSanCai(wuGe);
        const score = this.calculateNameScore(wuGe, sanCai);
        
        // åˆ†æäº”è¡ŒåŒ¹é…åº¦
        const neededWuXing = this.analyzeBaziWuXing(baziResult);
        const nameWuXing = this.getNameWuXing(firstName);
        const wuXingMatch = this.calculateWuXingMatch(neededWuXing, nameWuXing);
        
        return {
            fullName,
            surname,
            firstName,
            wuGe,
            sanCai,
            score,
            neededWuXing,
            nameWuXing,
            wuXingMatch,
            analysis: this.generateNameAnalysis(wuGe, sanCai, score, wuXingMatch)
        };
    }

    // è·å–å§“åçš„äº”è¡Œå±æ€§
    getNameWuXing(firstName) {
        const wuXingCount = { 'æœ¨': 0, 'ç«': 0, 'åœŸ': 0, 'é‡‘': 0, 'æ°´': 0 };

        firstName.split('').forEach(char => {
            // ä½¿ç”¨getCharWuXingæ–¹æ³•ï¼Œå®ƒåŒ…å«å¤‡ç”¨çš„ç¬”ç”»æ¨ç®—é€»è¾‘
            const charWuXing = this.getCharWuXing(char);
            if (charWuXing) {
                wuXingCount[charWuXing]++;
            }
        });

        return wuXingCount;
    }

    // è®¡ç®—äº”è¡ŒåŒ¹é…åº¦ï¼ˆæ”¹è¿›ç‰ˆ - çœŸæ­£çš„100åˆ†åˆ¶ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼‰
    calculateWuXingMatch(needed, actual) {
        // å¦‚æœæ²¡æœ‰éœ€è¦è¡¥å……çš„äº”è¡Œï¼Œè¯´æ˜å…«å­—å¹³è¡¡ï¼Œè¿”å›æ»¡åˆ†
        if (needed.length === 0) return 100;

        // ä½¿ç”¨æ•´æ•°è¿ç®—é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
        let matchScore = 0;
        const totalPoints = 10000; // ä½¿ç”¨10000ä½œä¸ºåŸºæ•°ï¼Œæœ€åé™¤ä»¥100
        const baseScore = Math.floor(totalPoints / needed.length);

        needed.forEach((wuXing, index) => {
            if (actual[wuXing] > 0) {
                // åŸºç¡€åˆ†æ•°
                let score = baseScore;

                // ç¬¬ä¸€ä¸ªäº”è¡Œï¼ˆæœ€é‡è¦çš„ï¼‰é¢å¤–åŠ æƒ 10%
                if (index === 0) {
                    score = Math.floor(score * 11 / 10);
                }

                // æ ¹æ®å­—æ•°ç»™äºˆå°å¹…åŠ åˆ†ï¼ˆæœ€å¤š5%ï¼‰
                const charCount = actual[wuXing];
                const bonusPercent = Math.min(charCount * 2, 5); // æ¯ä¸ªå­—2%ï¼Œæœ€å¤š5%
                score = Math.floor(score * (100 + bonusPercent) / 100);

                matchScore += score;
            }
        });

        // è½¬æ¢å›ç™¾åˆ†åˆ¶å¹¶ç¡®ä¿ä¸è¶…è¿‡100
        const finalScore = Math.floor(matchScore / 100);
        return Math.min(100, finalScore);
    }

    // è·å–äº”è¡ŒåŒ¹é…åº¦ç­‰çº§è¯„ä»·
    getWuXingMatchLevel(score) {
        if (score >= 90) return { level: 'å®Œç¾', emoji: 'ğŸŒŸ', color: '#28a745', desc: 'å§“åäº”è¡Œä¸å…«å­—éœ€æ±‚é«˜åº¦åŒ¹é…ï¼Œå¼ºçƒˆæ¨è' };
        if (score >= 70) return { level: 'ä¼˜ç§€', emoji: 'âœ…', color: '#20c997', desc: 'å§“åäº”è¡Œä¸å…«å­—éœ€æ±‚åŒ¹é…è‰¯å¥½ï¼Œæ¨èä½¿ç”¨' };
        if (score >= 50) return { level: 'è‰¯å¥½', emoji: 'ğŸ‘', color: '#ffc107', desc: 'å§“åäº”è¡Œä¸å…«å­—éœ€æ±‚éƒ¨åˆ†åŒ¹é…ï¼Œå¯ä»¥è€ƒè™‘' };
        if (score >= 30) return { level: 'ä¸€èˆ¬', emoji: 'âš ï¸', color: '#fd7e14', desc: 'å§“åäº”è¡Œä¸å…«å­—éœ€æ±‚åŒ¹é…åº¦è¾ƒä½ï¼Œå»ºè®®è°ƒæ•´' };
        return { level: 'ä¸ä½³', emoji: 'âŒ', color: '#dc3545', desc: 'å§“åäº”è¡Œä¸å…«å­—éœ€æ±‚ä¸åŒ¹é…ï¼Œå»ºè®®é‡æ–°èµ·å' };
    }

    // ç”Ÿæˆå§“ååˆ†ææŠ¥å‘Š
    generateNameAnalysis(wuGe, sanCai, score, wuXingMatch) {
        let analysis = `å§“åç»¼åˆè¯„åˆ†ï¼š${score}åˆ†\n\n`;
        
        analysis += `äº”æ ¼æ•°ç†ï¼š\n`;
        analysis += `å¤©æ ¼ï¼š${wuGe.tianGe} äººæ ¼ï¼š${wuGe.renGe} åœ°æ ¼ï¼š${wuGe.diGe}\n`;
        analysis += `å¤–æ ¼ï¼š${wuGe.waiGe} æ€»æ ¼ï¼š${wuGe.zongGe}\n\n`;
        
        analysis += `ä¸‰æ‰é…ç½®ï¼š${sanCai.tianWuXing}${sanCai.renWuXing}${sanCai.diWuXing} (${sanCai.jiXiong})\n\n`;
        
        analysis += `äº”è¡ŒåŒ¹é…åº¦ï¼š${wuXingMatch}åˆ†\n\n`;
        
        if (score >= 90) {
            analysis += `è¯„ä»·ï¼šä¼˜ç§€çš„å§“åï¼Œå„æ–¹é¢éƒ½å¾ˆåè°ƒã€‚`;
        } else if (score >= 80) {
            analysis += `è¯„ä»·ï¼šè‰¯å¥½çš„å§“åï¼Œå¤§éƒ¨åˆ†æ–¹é¢éƒ½ä¸é”™ã€‚`;
        } else if (score >= 70) {
            analysis += `è¯„ä»·ï¼šä¸€èˆ¬çš„å§“åï¼Œæœ‰æ”¹è¿›ç©ºé—´ã€‚`;
        } else {
            analysis += `è¯„ä»·ï¼šå»ºè®®è€ƒè™‘æ”¹åæˆ–è°ƒæ•´ã€‚`;
        }
        
        return analysis;
    }

    // ç”ŸæˆAIèµ·ååˆ†ææç¤ºè¯
    generateAINamingPrompt(birthData, baziResult, nameSuggestions, customConfig = {}) {
        const { gender, surname, year, month, day, hour, birthProvince, birthCity } = birthData;
        const { yearPillar, monthPillar, dayPillar, hourPillar, yearTenGod, monthTenGod, hourTenGod, dayMaster } = baziResult;
        const { firstChar, secondChar, candidateChars = [] } = customConfig;

        let prompt = "";
        prompt += `ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­å›½ä¼ ç»Ÿå§“åå­¦å’Œç°ä»£èµ·åç†è®ºçš„ä¸“å®¶ï¼Œæ“…é•¿ç»“åˆå…«å­—å‘½ç†ã€äº”æ ¼æ•°ç†ã€ä¸‰æ‰é…ç½®ã€å­—ä¹‰å†…æ¶µã€éŸ³éŸµç¾å­¦ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œç»¼åˆèµ·ååˆ†æã€‚\n\n`;

        prompt += `ä½ å…·å¤‡æ·±åšçš„å¤å…¸æ–‡å­¦åŠŸåº•ï¼Œç†Ÿæ‚‰ã€Šè¯—ç»ã€‹ã€ã€Šæ¥šè¾ã€‹ã€ã€Šè®ºè¯­ã€‹ã€ã€Šå­Ÿå­ã€‹ã€ã€Šå”è¯—ä¸‰ç™¾é¦–ã€‹ã€ã€Šå®‹è¯ã€‹ã€ã€Šå…ƒæ›²ã€‹ç­‰ç»å…¸æ–‡çŒ®ï¼Œèƒ½å¤Ÿå‡†ç¡®åˆ†ææ±‰å­—çš„æœ¬ä¹‰ã€å¼•ç”³ä¹‰ã€æ–‡åŒ–å†…æ¶µå’Œè¯—è¯å‡ºå¤„ã€‚ä½ å–„äºä»å¤å…¸è¯—è¯ä¸­å¯»æ‰¾ç¾å¥½çš„å­—è¯å¯“æ„ï¼Œä¸ºèµ·åæä¾›æ·±åšçš„æ–‡åŒ–åº•è•´ã€‚\n\n`;

        prompt += `è¯·è¿ç”¨ä½ çš„æ¨ç†èƒ½åŠ›ï¼Œé€æ­¥åˆ†ææ¯ä¸ªå€™é€‰å§“åçš„å„ä¸ªç»´åº¦ã€‚ç‰¹åˆ«æ˜¯åœ¨åˆ†æå­—ä¹‰å†…æ¶µæ—¶ï¼Œè¯·æ·±å…¥æŒ–æ˜æ¯ä¸ªå­—çš„æ–‡åŒ–å†…æ¶µå’Œè¯—è¯å…¸æ•…ï¼Œå°½å¯èƒ½æ‰¾å‡ºå…¶åœ¨å¤å…¸è¯—è¯ä¸­çš„å…·ä½“å‡ºå¤„å’Œç¾å¥½å¯“æ„ã€‚ä¾‹å¦‚ï¼š"æ˜"å­—å‡ºè‡ªã€Šè¯—ç»Â·å¤§é›…Â·çƒæ°‘ã€‹"æ—¢æ˜ä¸”å“²ï¼Œä»¥ä¿å…¶èº«"ï¼Œå¯“æ„èªæ˜ç¿æ™ºã€‚\n\n`;

        prompt += `ç°åœ¨éœ€è¦ä½ ä¸ºä¸€ä½æ±‚åè€…è¿›è¡Œä¸“ä¸šçš„èµ·ååˆ†æå’Œå»ºè®®ã€‚è¯·ä½ è¿ç”¨ä½ çš„ä¸“ä¸šçŸ¥è¯†ï¼Œå¯¹å€™é€‰å§“åè¿›è¡Œå…¨é¢è¯„ä¼°ï¼Œå¹¶ç»™å‡ºè¯¦ç»†çš„åˆ†æå’Œæ”¹è¿›å»ºè®®ã€‚\n\n`;

        prompt += `**é‡è¦è¦æ±‚**ï¼š\n`;
        prompt += `1. è¯·æ·±å…¥åˆ†ææ¯ä¸ªå€™é€‰åå­—çš„ä¼˜ç¼ºç‚¹\n`;
        prompt += `2. åŸºäºå…«å­—å‘½ç†éœ€æ±‚ï¼Œä¸»åŠ¨æ€è€ƒæ˜¯å¦æœ‰æ›´é€‚åˆçš„å­—è¯ç»„åˆ\n`;
        prompt += `3. å¦‚æœä½ è®¤ä¸ºæœ‰æ›´ä¼˜ç§€çš„åå­—æ¨èï¼Œè¯·æå‡º1-3ä¸ªä¸“å®¶æ¨èåå­—\n`;
        prompt += `4. å¯¹æ¨èåå­—æŒ‰ç…§åŒæ ·æ ‡å‡†ï¼ˆå…«å­—åŒ¹é…åº¦ã€äº”æ ¼æ•°ç†ã€å­—ä¹‰å†…æ¶µã€éŸ³éŸµç¾å­¦ï¼‰è¿›è¡Œå®Œæ•´åˆ†æ\n`;
        prompt += `5. è¯¦ç»†è¯´æ˜æ¨èåå­—ç›¸æ¯”å€™é€‰åå­—çš„å…·ä½“ä¼˜åŠ¿å’Œæ”¹è¿›ä¹‹å¤„\n\n`;

        // åŸºæœ¬ä¿¡æ¯
        prompt += `æ±‚åè€…åŸºæœ¬ä¿¡æ¯ï¼š\n`;
        prompt += `å§“æ°ï¼š${surname}\n`;
        prompt += `æ€§åˆ«ï¼š${gender}\n`;
        prompt += `å‡ºç”Ÿæ—¶é—´ï¼š${year}å¹´${month}æœˆ${day}æ—¥${hour}æ—¶\n`;
        prompt += `å‡ºç”Ÿåœ°åŒºï¼š${birthProvince || 'æœªçŸ¥'} ${birthCity || 'æœªçŸ¥'}\n\n`;

        // å…«å­—ä¿¡æ¯
        prompt += `ç”Ÿè¾°å…«å­—ï¼š\n`;
        prompt += `å¹´æŸ±ï¼š${yearPillar} (${yearTenGod})\n`;
        prompt += `æœˆæŸ±ï¼š${monthPillar} (${monthTenGod})\n`;
        prompt += `æ—¥æŸ±ï¼š${dayPillar} (æ—¥ä¸»ï¼š${baziResult.dayTianGan})\n`;
        prompt += `æ—¶æŸ±ï¼š${hourPillar} (${hourTenGod})\n\n`;

        // äº”è¡Œåˆ†æ
        const neededWuXing = this.analyzeBaziWuXing(baziResult);
        prompt += `å…«å­—äº”è¡Œåˆ†æï¼š\n`;
        prompt += `éœ€è¦è¡¥å……çš„äº”è¡Œï¼š${neededWuXing.join('ã€')}\n`;
        prompt += `äº”è¡Œå¼ºå¼±åˆ†æï¼šè¯·æ ¹æ®å…«å­—åˆ†æäº”è¡Œçš„æ—ºè¡°æƒ…å†µ\n`;
        prompt += `èµ·åæŒ‡å¯¼ï¼šåœ¨æ¨èåå­—æ—¶ï¼Œè¯·ä¼˜å…ˆé€‰æ‹©äº”è¡Œå±æ€§ä¸ºã€${neededWuXing.join('ã€')}ã€‘çš„å­—ï¼Œä»¥è¾¾åˆ°äº”è¡Œå¹³è¡¡çš„æ•ˆæœã€‚åŒæ—¶è€ƒè™‘å­—ä¹‰ç¾å¥½ã€éŸ³éŸµå’Œè°ã€æ–‡åŒ–å†…æ¶µä¸°å¯Œçš„å­—è¯ã€‚\n\n`;

        // è‡ªå®šä¹‰å­—é…ç½®
        if (firstChar || secondChar || candidateChars.length > 0) {
            prompt += `è‡ªå®šä¹‰ç”¨å­—è¦æ±‚ï¼š\n`;
            if (firstChar) {
                prompt += `æŒ‡å®šç¬¬ä¸€ä¸ªå­—ï¼ˆè¾ˆåˆ†å­—ï¼‰ï¼š${firstChar}\n`;
                prompt += `è¯´æ˜ï¼šè¿™æ˜¯å®¶æ—è¾ˆåˆ†å­—ï¼Œå¿…é¡»å›ºå®šåœ¨ç¬¬ä¸€ä¸ªä½ç½®\n`;
            }
            if (secondChar) {
                prompt += `æŒ‡å®šç¬¬äºŒä¸ªå­—ï¼ˆè¾ˆåˆ†å­—ï¼‰ï¼š${secondChar}\n`;
                prompt += `è¯´æ˜ï¼šè¿™ä¸ªå­—å¿…é¡»å›ºå®šåœ¨ç¬¬äºŒä¸ªä½ç½®\n`;
            }
            if (candidateChars.length > 0) {
                prompt += `å€™é€‰å­—åº“ï¼š${candidateChars.join('ã€')}\n`;
                prompt += `è¯´æ˜ï¼šè¯·ä¼˜å…ˆä»è¿™äº›å€™é€‰å­—ä¸­é€‰æ‹©æ­é…\n`;
            }
            prompt += `è¯·ç‰¹åˆ«å…³æ³¨è‡ªå®šä¹‰å­—çš„ä½¿ç”¨ï¼Œåˆ†æå…¶äº”è¡Œå±æ€§ã€å­—ä¹‰å†…æ¶µå’Œä¸å…«å­—çš„åŒ¹é…åº¦\n\n`;
        }

        return prompt;
    }

    // ç”Ÿæˆå€™é€‰å§“ååˆ†æéƒ¨åˆ†çš„æç¤ºè¯
    generateCandidateAnalysisPrompt(nameSuggestions) {
        let prompt = `å€™é€‰å§“ååˆ†æï¼š\n`;
        prompt += `ä»¥ä¸‹æ˜¯åŸºäºä¼ ç»Ÿç®—æ³•ç”Ÿæˆçš„${nameSuggestions.length}ä¸ªå€™é€‰å§“åï¼Œè¯·å¯¹æ¯ä¸ªå§“åè¿›è¡Œè¯¦ç»†åˆ†æï¼š\n\n`;

        nameSuggestions.forEach((suggestion, index) => {
            const { fullName, wuGe, sanCai, score, wuXingMatch, firstName } = suggestion;
            prompt += `${index + 1}. ${fullName}\n`;
            prompt += `   ä¼ ç»Ÿè¯„åˆ†ï¼š${score}åˆ†\n`;
            prompt += `   äº”æ ¼æ•°ç†ï¼šå¤©æ ¼${wuGe.tianGe} äººæ ¼${wuGe.renGe} åœ°æ ¼${wuGe.diGe} å¤–æ ¼${wuGe.waiGe} æ€»æ ¼${wuGe.zongGe}\n`;
            prompt += `   ä¸‰æ‰é…ç½®ï¼š${sanCai.tianWuXing}${sanCai.renWuXing}${sanCai.diWuXing} (${sanCai.jiXiong})\n`;
            prompt += `   äº”è¡ŒåŒ¹é…ï¼š${wuXingMatch.join('ã€')}\n`;

            // æ·»åŠ å­—ä¹‰åˆ†æè¦æ±‚
            if (firstName && firstName.length >= 1) {
                prompt += `   è¯·é‡ç‚¹åˆ†æï¼š\n`;
                for (let i = 0; i < firstName.length; i++) {
                    const char = firstName[i];
                    prompt += `   - "${char}"å­—çš„å«ä¹‰ã€å‡ºå¤„å’Œæ–‡åŒ–å†…æ¶µ\n`;
                }
            }
            prompt += `\n`;
        });

        return prompt;
    }

    // ç”Ÿæˆåˆ†æè¦æ±‚éƒ¨åˆ†çš„æç¤ºè¯
    generateAnalysisRequirementsPrompt() {
        let prompt = `è¯·ä½ ä»ä»¥ä¸‹ç»´åº¦å¯¹æ¯ä¸ªå€™é€‰å§“åè¿›è¡Œä¸“ä¸šåˆ†æï¼š\n\n`;
        prompt += `1. **å…«å­—åŒ¹é…åº¦åˆ†æ**ï¼š\n`;
        prompt += `   - å§“åäº”è¡Œæ˜¯å¦èƒ½æœ‰æ•ˆè¡¥å……å…«å­—æ‰€éœ€\n`;
        prompt += `   - ä¸æ—¥ä¸»çš„ç”Ÿå…‹å…³ç³»æ˜¯å¦å’Œè°\n`;
        prompt += `   - å¯¹å‘½ä¸»è¿åŠ¿çš„å½±å“\n\n`;

        prompt += `2. **äº”æ ¼æ•°ç†è¯„ä¼°**ï¼š\n`;
        prompt += `   - å„æ ¼æ•°ç†çš„å‰å‡¶åˆ†æ\n`;
        prompt += `   - æ•°ç†å¯¹æ€§æ ¼ã€äº‹ä¸šã€å¥åº·ã€æ„Ÿæƒ…çš„å½±å“\n`;
        prompt += `   - ä¸‰æ‰é…ç½®çš„å…·ä½“å«ä¹‰\n\n`;

        prompt += `3. **å­—ä¹‰å†…æ¶µåˆ†æ**ï¼š\n`;
        prompt += `   - æ¯ä¸ªå­—çš„æœ¬ä¹‰ã€å¼•ç”³ä¹‰å’Œæ–‡åŒ–å†…æ¶µ\n`;
        prompt += `   - å­—çš„è¯—è¯å‡ºå¤„å’Œå…¸æ•…æ¥æºï¼ˆå¦‚å¼•ç”¨äº†å“ªå¥å¤è¯—è¯çš„å“ªä¸ªå­—ï¼‰\n`;
        prompt += `   - å­—ä¸å­—ä¹‹é—´çš„æ­é…æ˜¯å¦å’Œè°\n`;
        prompt += `   - æ•´ä½“å¯“æ„æ˜¯å¦ç§¯æå‘ä¸Š\n`;
        prompt += `   - æ˜¯å¦ä½“ç°äº†æ·±åšçš„æ–‡åŒ–åº•è•´\n\n`;

        prompt += `4. **éŸ³éŸµç¾å­¦è¯„ä»·**ï¼š\n`;
        prompt += `   - å£°è°ƒæ­é…æ˜¯å¦ä¼˜ç¾\n`;
        prompt += `   - æ˜¯å¦æœ—æœ—ä¸Šå£\n`;
        prompt += `   - é¿å…è°éŸ³æ­§ä¹‰\n\n`;

        prompt += `5. **æ–‡åŒ–å†…æ¶µè€ƒé‡**ï¼š\n`;
        prompt += `   - æ˜¯å¦ç¬¦åˆä¼ ç»Ÿæ–‡åŒ–å®¡ç¾\n`;
        prompt += `   - æ—¶ä»£ç‰¹è‰²å’Œç°ä»£æ„Ÿ\n`;
        prompt += `   - æ€§åˆ«ç‰¹å¾æ˜¯å¦æ˜æ˜¾\n\n`;

        prompt += `6. **å®ç”¨æ€§è€ƒè™‘**ï¼š\n`;
        prompt += `   - ä¹¦å†™æ˜¯å¦ç®€ä¾¿\n`;
        prompt += `   - æ˜¯å¦å®¹æ˜“è¢«è¯¯è¯»è¯¯å†™\n`;
        prompt += `   - åœ¨ç°ä»£ç¤¾ä¼šçš„é€‚ç”¨æ€§\n\n`;

        return prompt;
    }

    // ç”Ÿæˆè¾“å‡ºæ ¼å¼è¦æ±‚çš„æç¤ºè¯
    generateOutputFormatPrompt() {
        let prompt = `è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼š\n\n`;
        prompt += `## å…«å­—äº”è¡Œåˆ†æ\n`;
        prompt += `[è¯¦ç»†åˆ†æå…«å­—äº”è¡Œçš„æ—ºè¡°æƒ…å†µå’Œéœ€è¦è¡¥å……çš„äº”è¡Œ]\n\n`;

        prompt += `## å€™é€‰å§“åè¯¦ç»†åˆ†æ\n`;
        prompt += `### 1. [å§“å] - AIç»¼åˆè¯„åˆ†ï¼š[åˆ†æ•°]/100\n`;
        prompt += `**å…«å­—åŒ¹é…åº¦**ï¼š[åˆ†æå†…å®¹]\n`;
        prompt += `**äº”æ ¼æ•°ç†**ï¼š[åˆ†æå†…å®¹]\n`;
        prompt += `**å­—ä¹‰å†…æ¶µ**ï¼š\n`;
        prompt += `- [ç¬¬ä¸€ä¸ªå­—]ï¼šå­—ä¹‰ã€å‡ºå¤„å…¸æ•…ã€æ–‡åŒ–å†…æ¶µ\n`;
        prompt += `- [ç¬¬äºŒä¸ªå­—]ï¼šå­—ä¹‰ã€å‡ºå¤„å…¸æ•…ã€æ–‡åŒ–å†…æ¶µ\n`;
        prompt += `- æ•´ä½“å¯“æ„å’Œå­—è¯æ­é…åˆ†æ\n`;
        prompt += `**éŸ³éŸµç¾å­¦**ï¼š[åˆ†æå†…å®¹]\n`;
        prompt += `**ç»¼åˆè¯„ä»·**ï¼š[æ€»ä½“è¯„ä»·å’Œå»ºè®®]\n\n`;
        prompt += `[å¯¹å…¶ä»–å€™é€‰å§“åè¿›è¡ŒåŒæ ·æ ¼å¼çš„åˆ†æ]\n\n`;

        prompt += `## ğŸŒŸ ä¸“å®¶æ¨èåå­—ï¼ˆå¦‚æœ‰æ›´ä¼˜é€‰æ‹©ï¼‰\n`;
        prompt += `å¦‚æœä½ è®¤ä¸ºæœ‰æ¯”å€™é€‰åå­—æ›´é€‚åˆçš„é€‰æ‹©ï¼Œè¯·æå‡º1-3ä¸ªæ¨èåå­—ï¼š\n\n`;
        prompt += `### æ¨è1. [æ¨èå§“å] - AIç»¼åˆè¯„åˆ†ï¼š[åˆ†æ•°]/100\n`;
        prompt += `**æ¨èç†ç”±**ï¼š[ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªåå­—ï¼Œç›¸æ¯”å€™é€‰åå­—çš„ä¼˜åŠ¿]\n`;
        prompt += `**å…«å­—åŒ¹é…åº¦**ï¼š[è¯¦ç»†åˆ†æå¦‚ä½•æ›´å¥½åœ°åŒ¹é…å…«å­—]\n`;
        prompt += `**äº”æ ¼æ•°ç†**ï¼š[è¯¦ç»†åˆ†æäº”æ ¼é…ç½®]\n`;
        prompt += `**å­—ä¹‰å†…æ¶µ**ï¼š\n`;
        prompt += `- [ç¬¬ä¸€ä¸ªå­—]ï¼šå­—ä¹‰ã€å‡ºå¤„å…¸æ•…ã€æ–‡åŒ–å†…æ¶µ\n`;
        prompt += `- [ç¬¬äºŒä¸ªå­—]ï¼šå­—ä¹‰ã€å‡ºå¤„å…¸æ•…ã€æ–‡åŒ–å†…æ¶µ\n`;
        prompt += `- æ•´ä½“å¯“æ„å’Œå­—è¯æ­é…åˆ†æ\n`;
        prompt += `**éŸ³éŸµç¾å­¦**ï¼š[è¯¦ç»†åˆ†æéŸ³éŸµæ•ˆæœ]\n`;
        prompt += `**ç»¼åˆè¯„ä»·**ï¼š[ä¸ºä»€ä¹ˆæ¯”å€™é€‰åå­—æ›´ä¼˜ç§€çš„å…·ä½“åŸå› ]\n\n`;
        prompt += `[å¦‚æœ‰å…¶ä»–æ¨èåå­—ï¼Œè¯·æŒ‰åŒæ ·æ ¼å¼ç»§ç»­]\n\n`;

        prompt += `## æœ€ç»ˆæ¨è\n`;
        prompt += `**æœ€æ¨èçš„å§“å**ï¼š[å§“å]\n`;
        prompt += `**æ¨èç†ç”±**ï¼š[è¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªå§“å]\n\n`;

        prompt += `## èµ·åå»ºè®®\n`;
        prompt += `**æ”¹è¿›æ–¹å‘**ï¼š[å¦‚æœéœ€è¦é‡æ–°èµ·åï¼Œåº”è¯¥æ³¨æ„å“ªäº›æ–¹é¢]\n`;
        prompt += `**ç”¨å­—å»ºè®®**ï¼š[æ¨èä½¿ç”¨å“ªäº›å­—ï¼Œé¿å…å“ªäº›å­—]\n`;
        prompt += `**å…¶ä»–å»ºè®®**ï¼š[å…¶ä»–æœ‰ä»·å€¼çš„èµ·åå»ºè®®]\n\n`;

        prompt += `è¯·ç¡®ä¿åˆ†æä¸“ä¸šã€è¯¦ç»†ã€å®ç”¨ï¼Œæ—¢è¦ä½“ç°ä¼ ç»Ÿå§“åå­¦çš„æ·±åº¦ï¼Œä¹Ÿè¦ç»“åˆç°ä»£èµ·åçš„å®é™…éœ€æ±‚ã€‚`;

        return prompt;
    }

    // ç”Ÿæˆå®Œæ•´çš„AIèµ·ååˆ†ææç¤ºè¯
    generateCompleteAINamingPrompt(birthData, baziResult, nameSuggestions, customChars = []) {
        let fullPrompt = this.generateAINamingPrompt(birthData, baziResult, nameSuggestions, customChars);
        fullPrompt += this.generateCandidateAnalysisPrompt(nameSuggestions);
        fullPrompt += this.generateAnalysisRequirementsPrompt();
        fullPrompt += this.generateOutputFormatPrompt();

        return fullPrompt;
    }
}

// å¯¼å‡ºæ¨¡å—
window.NameCalculator = NameCalculator;
