<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç»“æœæ˜¾ç¤ºæµ‹è¯•</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            padding: 20px;
            background: #0a0a0a;
            color: #00ff88;
            font-family: 'Courier New', monospace;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 5px;
        }
        .test-button {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        .element-status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.5);
        }
        .element-status.found {
            border: 1px solid #00ff88;
            color: #00ff88;
        }
        .element-status.not-found {
            border: 1px solid #ff4444;
            color: #ff4444;
        }
        .log-area {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff88;
            border-radius: 4px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” AIç»“æœæ˜¾ç¤ºæµ‹è¯•</h1>
        <p>ä¸“é—¨æµ‹è¯•AIåˆ†æç»“æœæ˜¯å¦èƒ½æ­£ç¡®æ˜¾ç¤º</p>
        
        <!-- å…ƒç´ æ£€æŸ¥ -->
        <div class="test-section">
            <h3>1. æ£€æŸ¥å¿…è¦çš„DOMå…ƒç´ </h3>
            <button class="test-button" onclick="checkElements()">æ£€æŸ¥å…ƒç´ </button>
            <div id="element-check-results"></div>
        </div>

        <!-- æ¨¡æ‹ŸAIåˆ†æ -->
        <div class="test-section">
            <h3>2. æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹</h3>
            <button class="test-button" onclick="simulateAIAnalysis()">æ¨¡æ‹ŸAIåˆ†æ</button>
            <button class="test-button" onclick="simulateAIError()">æ¨¡æ‹ŸAIé”™è¯¯</button>
            <div id="simulation-results"></div>
        </div>

        <!-- å®é™…AIæµ‹è¯• -->
        <div class="test-section">
            <h3>3. å®é™…AIåˆ†ææµ‹è¯•</h3>
            <div style="margin-bottom: 10px;">
                <input type="text" id="test-api-url" placeholder="APIåœ°å€" style="width: 300px; padding: 5px; margin-right: 5px;">
                <input type="password" id="test-api-key" placeholder="APIå¯†é’¥" style="width: 200px; padding: 5px; margin-right: 5px;">
                <select id="test-model" style="padding: 5px;">
                    <option value="deepseek-reasoner">DeepSeek-R1</option>
                    <option value="deepseek-chat">DeepSeek-V3</option>
                </select>
            </div>
            <button class="test-button" onclick="testRealAI()">æµ‹è¯•çœŸå®AI</button>
            <div id="real-ai-results"></div>
        </div>

        <!-- æ—¥å¿— -->
        <div class="test-section">
            <h3>4. æµ‹è¯•æ—¥å¿—</h3>
            <div id="test-log" class="log-area"></div>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <!-- æ¨¡æ‹Ÿçš„AIåˆ†æåŒºåŸŸ -->
        <div class="test-section">
            <h3>5. æ¨¡æ‹ŸAIåˆ†æåŒºåŸŸ</h3>
            <div class="ai-naming-section">
                <div class="ai-naming-processing" id="ai-naming-processing" style="display: none;">
                    <div class="processing-message" id="ai-naming-processing-message">æ­£åœ¨åˆå§‹åŒ–AIåˆ†æ...</div>
                    <div class="processing-steps" id="ai-naming-processing-steps"></div>
                </div>
                
                <div class="ai-naming-result-section" id="ai-naming-result-section" style="display: none;">
                    <h5>AIåˆ†æç»“æœï¼š</h5>
                    <div class="ai-naming-output" id="ai-naming-output"></div>
                    <div class="result-actions">
                        <button class="cyber-button" id="copy-ai-naming-result" style="display: none;">
                            <span>ğŸ“„ å¤åˆ¶åˆ†æç»“æœ</span>
                        </button>
                    </div>
                </div>
                
                <div class="api-error-message" id="ai-naming-error-message" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="js/bazi-calculator.js"></script>
    <script src="js/name-calculator.js"></script>
    <script src="js/main.js"></script>

    <script>
        let app;

        function log(message, type = 'info') {
            const logArea = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#00ff88' : type === 'warning' ? '#ffc107' : '#ffffff';
            logArea.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        function checkElements() {
            const elements = [
                'ai-naming-processing',
                'ai-naming-processing-message',
                'ai-naming-processing-steps',
                'ai-naming-result-section',
                'ai-naming-output',
                'copy-ai-naming-result',
                'ai-naming-error-message'
            ];

            const resultsDiv = document.getElementById('element-check-results');
            resultsDiv.innerHTML = '';

            log('å¼€å§‹æ£€æŸ¥DOMå…ƒç´ ...');

            elements.forEach(id => {
                const element = document.getElementById(id);
                const status = element ? 'found' : 'not-found';
                const statusText = element ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°';
                
                resultsDiv.innerHTML += `<div class="element-status ${status}">${id}: ${statusText}</div>`;
                log(`å…ƒç´  ${id}: ${statusText}`, element ? 'success' : 'error');
            });
        }

        function simulateAIAnalysis() {
            log('å¼€å§‹æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹...');
            
            if (!app) {
                app = new CyberFortuneApp();
            }

            // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
            app.showAINamingProcessing();
            log('æ˜¾ç¤ºå¤„ç†çŠ¶æ€', 'success');

            // æ¨¡æ‹Ÿå¤„ç†è¿‡ç¨‹
            const processingSteps = document.getElementById('ai-naming-processing-steps');
            const processingMessage = document.getElementById('ai-naming-processing-message');
            const aiOutput = document.getElementById('ai-naming-output');
            const aiResultSection = document.getElementById('ai-naming-result-section');
            const copyBtn = document.getElementById('copy-ai-naming-result');

            setTimeout(() => {
                processingSteps.innerHTML = 'ğŸ”— æ­£åœ¨è¿æ¥AIæœåŠ¡å™¨...<br>';
                processingMessage.textContent = 'å»ºç«‹è¿æ¥ä¸­...';
                log('æ¨¡æ‹Ÿè¿æ¥çŠ¶æ€', 'info');
            }, 500);

            setTimeout(() => {
                processingSteps.innerHTML += 'ğŸ¤– AIæ­£åœ¨åˆ†æèµ·åæ–¹æ¡ˆ...<br>';
                processingMessage.textContent = 'æ­£åœ¨ç”Ÿæˆåˆ†æç»“æœ...';
                
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                aiResultSection.style.display = 'block';
                log('æ˜¾ç¤ºç»“æœåŒºåŸŸ', 'success');
                
                // æ¨¡æ‹ŸAIè¾“å‡º
                const mockResult = `
# æ™ºèƒ½èµ·ååˆ†ææŠ¥å‘Š

## å§“åæ¨èåˆ†æ

### 1. é™ˆæ˜è½©
- **ä¼ ç»Ÿè¯„åˆ†**: 92åˆ†
- **äº”è¡ŒåŒ¹é…**: ç«ã€é‡‘ã€åœŸ
- **å­—ä¹‰åˆ†æ**: 
  - "æ˜"å­—å‡ºè‡ªã€Šè¯—ç»Â·å¤§é›…Â·çƒæ°‘ã€‹"æ—¢æ˜ä¸”å“²ï¼Œä»¥ä¿å…¶èº«"ï¼Œå¯“æ„èªæ˜ç¿æ™º
  - "è½©"å­—æ„ä¸ºé«˜è¿œã€æ°”å®‡è½©æ˜‚ï¼Œè±¡å¾å¿—å‘è¿œå¤§

### 2. é™ˆæ€è¿œ
- **ä¼ ç»Ÿè¯„åˆ†**: 89åˆ†  
- **äº”è¡ŒåŒ¹é…**: é‡‘ã€åœŸ
- **å­—ä¹‰åˆ†æ**:
  - "æ€"å­—ä»£è¡¨æ€è€ƒã€æ™ºæ…§
  - "è¿œ"å­—å¯“æ„å¿—å‘è¿œå¤§ã€å‰ç¨‹ä¼¼é”¦

## ç»¼åˆå»ºè®®
æ ¹æ®å…«å­—åˆ†æï¼Œå»ºè®®é€‰æ‹©äº”è¡Œå±ç«ã€é‡‘çš„å­—ï¼Œä»¥å¹³è¡¡å‘½ç†ã€‚æ¨è"é™ˆæ˜è½©"ä½œä¸ºé¦–é€‰ã€‚
                `;
                
                aiOutput.innerHTML = app.simpleMarkdownParse(mockResult);
                log('æ¨¡æ‹ŸAIè¾“å‡ºå†…å®¹', 'success');
            }, 1500);

            setTimeout(() => {
                processingSteps.innerHTML += 'âœ… AIèµ·ååˆ†æå®Œæˆ<br>';
                processingMessage.textContent = 'åˆ†æå®Œæˆï¼';
                
                // æ˜¾ç¤ºå¤åˆ¶æŒ‰é’®
                copyBtn.style.display = 'block';
                
                // éšè—å¤„ç†çŠ¶æ€ï¼Œæ˜¾ç¤ºç»“æœ
                app.hideAINamingProcessing();
                log('AIåˆ†ææ¨¡æ‹Ÿå®Œæˆ', 'success');
                
                document.getElementById('simulation-results').innerHTML = '<div style="color: #00ff88;">âœ… AIåˆ†ææ¨¡æ‹ŸæˆåŠŸå®Œæˆ</div>';
            }, 2500);
        }

        function simulateAIError() {
            log('å¼€å§‹æ¨¡æ‹ŸAIé”™è¯¯...');
            
            if (!app) {
                app = new CyberFortuneApp();
            }

            // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
            app.showAINamingProcessing();
            
            setTimeout(() => {
                app.showAINamingError('æ¨¡æ‹Ÿçš„APIè¿æ¥å¤±è´¥');
                log('æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', 'error');
                
                document.getElementById('simulation-results').innerHTML = '<div style="color: #ff4444;">âŒ AIé”™è¯¯æ¨¡æ‹Ÿå®Œæˆ</div>';
            }, 1000);
        }

        async function testRealAI() {
            const apiUrl = document.getElementById('test-api-url').value;
            const apiKey = document.getElementById('test-api-key').value;
            const model = document.getElementById('test-model').value;

            if (!apiUrl || !apiKey) {
                log('è¯·å¡«å†™APIé…ç½®', 'error');
                return;
            }

            // ä¿å­˜é…ç½®
            const config = { apiUrl, apiKey, model };
            localStorage.setItem('cyberFortune_globalConfig', JSON.stringify(config));
            log(`é…ç½®å·²ä¿å­˜: ${model}`, 'success');

            if (!app) {
                app = new CyberFortuneApp();
            }

            // æ„å»ºæµ‹è¯•æ•°æ®
            const birthData = {
                surname: 'æµ‹è¯•',
                gender: 'ç”·',
                year: 1990,
                month: 5,
                day: 15,
                hour: 10,
                minute: 0,
                birthProvince: 'åŒ—äº¬å¸‚',
                birthCity: 'åŒ—äº¬å¸‚',
                customConfig: {}
            };

            try {
                log('å¼€å§‹çœŸå®AIæµ‹è¯•...');
                
                const baziResult = app.baziCalculator.calculate(birthData);
                const nameSuggestions = app.nameCalculator.generateNameSuggestions(
                    birthData.surname, birthData.gender, baziResult, birthData.customConfig
                );
                const aiPrompt = app.nameCalculator.generateCompleteAINamingPrompt(
                    birthData, baziResult, nameSuggestions, birthData.customConfig
                );

                await app.generateNamingAIAnalysis(birthData, baziResult, nameSuggestions, aiPrompt);
                
                document.getElementById('real-ai-results').innerHTML = '<div style="color: #00ff88;">âœ… çœŸå®AIæµ‹è¯•å·²å¯åŠ¨</div>';
                log('çœŸå®AIæµ‹è¯•å·²å¯åŠ¨', 'success');

            } catch (error) {
                const message = `çœŸå®AIæµ‹è¯•å¤±è´¥: ${error.message}`;
                document.getElementById('real-ai-results').innerHTML = `<div style="color: #ff4444;">âŒ ${message}</div>`;
                log(message, 'error');
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('AIç»“æœæ˜¾ç¤ºæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // åŠ è½½ç°æœ‰é…ç½®
            const existingConfig = localStorage.getItem('cyberFortune_globalConfig');
            if (existingConfig) {
                try {
                    const config = JSON.parse(existingConfig);
                    document.getElementById('test-api-url').value = config.apiUrl || '';
                    document.getElementById('test-api-key').value = config.apiKey || '';
                    document.getElementById('test-model').value = config.model || 'deepseek-reasoner';
                    log('å·²åŠ è½½ç°æœ‰é…ç½®', 'success');
                } catch (error) {
                    log('åŠ è½½é…ç½®å¤±è´¥', 'warning');
                }
            }

            // è‡ªåŠ¨æ£€æŸ¥å…ƒç´ 
            setTimeout(checkElements, 500);
        });
    </script>
</body>
</html>
